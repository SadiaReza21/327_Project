# BAZAR KORI E-COMMERCE - COMPLETE PROJECT CODE
# Generated on: Fri Dec  5 23:14:59 +06 2025
# ===========================================

## MAIN.PY

// Path: main.py

from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from fastapi.staticfiles import StaticFiles
from fastapi.responses import HTMLResponse
from controllers.search_controller import SearchController
from controllers.filter_controller import FilterController
import os


class BazarKoriApp:
    """
    Main application factory class
    Sets up FastAPI app with routes, middleware, and static files
    """

    def __init__(self):
        self.app = FastAPI(
            title="Bazar Kori E-Commerce API",
            description="Search and Filter Products - MVC Architecture",
            version="1.0.0",
            docs_url="/api/docs",  # Added for Swagger UI
            redoc_url="/api/redoc"  # Added for ReDoc
        )
        self.search_controller = SearchController()
        self.filter_controller = FilterController()

        self.fun_setup_middleware()
        self.fun_setup_routes()
        self.fun_setup_static_files()
        self.fun_setup_html_routes()

    def fun_setup_middleware(self):
        """Allow frontend to talk to backend"""
        self.app.add_middleware(
            CORSMiddleware,
            allow_origins=["*"],
            allow_credentials=True,
            allow_methods=["*"],
            allow_headers=["*"],
        )

    def fun_setup_routes(self):
        """Register all API controllers"""
        self.app.include_router(self.search_controller.router)
        self.app.include_router(self.filter_controller.router)

    def fun_setup_static_files(self):
        """Serve CSS, JS, images from /views folder as /static"""
        views_path = os.path.join(os.path.dirname(__file__), "views")
        if os.path.exists(views_path):
            self.app.mount("/static", StaticFiles(directory=views_path), name="static")
        else:
            print("Warning: 'views' folder not found!")

    def fun_setup_html_routes(self):
        """Serve the two main HTML pages"""

        # Home page ‚Üí search page
        @self.app.get("/", response_class=HTMLResponse)
        async def serve_search_page():
            """Serve search.html as the homepage"""
            file_path = os.path.join(os.path.dirname(__file__), "views", "search.html")
            if not os.path.exists(file_path):
                return HTMLResponse("search.html not found", status_code=404)
            with open(file_path, "r", encoding="utf-8") as f:
                return f.read()

        # Filter/Browse page
        @self.app.get("/filter", response_class=HTMLResponse)
        async def serve_filter_page():
            """Serve filter.html for advanced browsing"""
            file_path = os.path.join(os.path.dirname(__file__), "views", "filter.html")
            if not os.path.exists(file_path):
                return HTMLResponse("filter.html not found", status_code=404)
            with open(file_path, "r", encoding="utf-8") as f:
                return f.read()

    def fun_get_app(self):
        """Return the configured FastAPI instance"""
        return self.app


# Factory function for Uvicorn
def fun_create_app():
    """Factory function to create app instance"""
    app = BazarKoriApp()
    return app.fun_get_app()


app = fun_create_app()


if __name__ == "__main__":
    import uvicorn
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)
---

## CONTROLLERS

### __init__.py
// Path: controllers/__init__.py


---

### filter_controller.py
// Path: controllers/filter_controller.py

from fastapi import APIRouter, HTTPException, Query
from typing import Optional # ADD THIS IMPORT
from models.filter_model import (
    FilterRequestModel,
    FilterResponseModel,
    FilterErrorResponseModel
)
from services.filter_service import (
    FilterService,
    InvalidFilterInputError, # Make sure this is imported
    DatabaseConnectionError
)
from services.product_service import ProductService

class FilterController:
    """
    Controller for product filtering operations
    """
   
    def __init__(self):
        """Initialize the FilterController with router and services."""
        self.router = APIRouter()
        product_service = ProductService()
        self.filter_service = FilterService(product_service)
        self.fun_setup_routes()
   
   
    def fun_setup_routes(self):
        """
        Setup API routes for filter functionality
        """
        self.router.add_api_route(
            path="/api/v1/filter",
            endpoint=self.fun_handle_filter,
            methods=["GET"],
            response_model=FilterResponseModel,
            responses={
                400: {"model": FilterErrorResponseModel},
                500: {"model": FilterErrorResponseModel}
            }
        )
       
        self.router.add_api_route(
            path="/api/v1/filter/categories",
            endpoint=self.fun_get_categories,
            methods=["GET"],
            response_model=list
        )
   
   
    async def fun_handle_filter(
        self,
        category: Optional[str] = Query(
            None,
            description="Filter by specific category"
        ),
        min_price: Optional[float] = Query(
            None,
            ge=0, # FIXED: Changed g==0 to ge=0
            description="Minimum price filter"
        ),
        max_price: Optional[float] = Query(
            None,
            ge=0, # FIXED: Changed g==0 to ge=0
            description="Maximum price filter"
        ),
        search: Optional[str] = Query(
            None,
            description="Search by product name"
        ),
        sort: Optional[str] = Query(
            None,
            description="Sort by: price_low, price_high, name_asc, name_desc"
        )
    ) -> FilterResponseModel:
        """
        Handle product filter requests with enhanced filtering
        """
        try:
            # Create filter request model from query parameters
            filter_request = FilterRequestModel(
                category=category,
                min_price=min_price,
                max_price=max_price
            )
           
            # Apply filters using the filter service
            filter_results = self.filter_service.fun_filter_products(
                filter_request
            )
           
            # Apply search filter if provided
            if search:
                filtered_results = [
                    product for product in filter_results.products
                    if search.lower() in product.name.lower()
                ]
                filter_results.products = filtered_results
                filter_results.total_count = len(filtered_results)
           
            # Apply sorting if requested
            if sort:
                if sort == "price_low":
                    filter_results.products.sort(key=lambda x: x.price)
                elif sort == "price_high":
                    filter_results.products.sort(key=lambda x: x.price, reverse=True)
                elif sort == "name_asc":
                    filter_results.products.sort(key=lambda x: x.name)
                elif sort == "name_desc":
                    filter_results.products.sort(key=lambda x: x.name, reverse=True)
           
            return filter_results
           
        except InvalidFilterInputError as invalid_input_error:
            raise HTTPException(
                status_code=400,
                detail={
                    "error": "Invalid filter input",
                    "details": str(invalid_input_error)
                }
            )
        except DatabaseConnectionError as db_connection_error:
            raise HTTPException(
                status_code=500,
                detail={
                    "error": "Database unavailable",
                    "details": "Unable to load filter results. Please try again later."
                }
            )
        except Exception as unexpected_error:
            raise HTTPException(
                status_code=500,
                detail={
                    "error": "Filter failed",
                    "details": "Please try again later."
                }
            )
   
   
    async def fun_get_categories(self):
        """
        Get all available categories for filtering
        """
        try:
            # Retrieve categories from the filter service
            categories = self.filter_service.fun_get_categories()
            return categories
        except DatabaseConnectionError as db_error:
            raise HTTPException(
                status_code=500,
                detail={
                    "error": "Failed to fetch categories",
                    "details": str(db_error)
                }
            )
---

### search_controller.py
// Path: controllers/search_controller.py

from fastapi import APIRouter, HTTPException, Query
from models.product_model import ProductModel, SearchRequestModel, SearchResponseModel, ErrorResponseModel
from services.product_service import ProductService, InvalidSearchInputError, DatabaseConnectionError
from typing import List, Optional

class SearchController:
    """Controller for product search operations."""
   
    def __init__(self):
        """Initialize the SearchController with router and product service."""
        self.router = APIRouter()
        self.product_service = ProductService()
        self.fun_setup_routes()
   
   
    def fun_setup_routes(self):
        """
        Setup API routes for search functionality
        """
        self.router.add_api_route(
            path="/api/v1/search",
            endpoint=self.fun_handle_search,
            methods=["GET"],
            response_model=SearchResponseModel,
            responses={
                400: {"model": ErrorResponseModel},
                500: {"model": ErrorResponseModel}
            }
        )
       
        self.router.add_api_route(
            path="/api/v1/products",
            endpoint=self.fun_get_all_products,
            methods=["GET"],
            response_model=List[ProductModel]
        )
       
        self.router.add_api_route(
            path="/api/v1/categories",
            endpoint=self.fun_get_categories,
            methods=["GET"],
            response_model=List[str]
        )
   
   
    async def fun_handle_search(
        self,
        query: str = Query(..., min_length=1, description="Product name or category to search"),
        category: Optional[str] = Query(None, description="Filter by specific category"),
        min_price: Optional[float] = Query(None, ge=0, description="Minimum price filter"),
        max_price: Optional[float] = Query(None, ge=0, description="Maximum price filter")
    ) -> SearchResponseModel:
        """
        Handle product search requests
        """
        try:
            # Create search request model from query parameters
            search_request = SearchRequestModel(
                query=query,
                category=category,
                min_price=min_price,
                max_price=max_price
            )
           
            # Perform search using the product service
            search_results = self.product_service.fun_search_products(search_request)
            return search_results
           
        except InvalidSearchInputError as invalid_input_error:
            raise HTTPException(
                status_code=400,
                detail={
                    "error": "Invalid search input",
                    "details": str(invalid_input_error)
                }
            )
        except DatabaseConnectionError as db_connection_error:
            raise HTTPException(
                status_code=500,
                detail={
                    "error": "Database unavailable",
                    "details": "Unable to load search results. Please try again later."
                }
            )
        except Exception as unexpected_error:
            raise HTTPException(
                status_code=500,
                detail={
                    "error": "Search failed",
                    "details": "Please try again later."
                }
            )
   
   
    async def fun_get_all_products(self):
        """
        Get all available products
        """
        try:
            # Retrieve all products from the product service
            products = self.product_service.fun_get_all_products()
            return products
        except DatabaseConnectionError as db_error:
            raise HTTPException(
                status_code=500,
                detail={
                    "error": "Failed to fetch products",
                    "details": str(db_error)
                }
            )
   
   
    async def fun_get_categories(self):
        """
        Get all available categories
        """
        try:
            # Retrieve categories from the product service
            categories = self.product_service.fun_get_categories()
            return categories
        except DatabaseConnectionError as db_error:
            raise HTTPException(
                status_code=500,
                detail={
                    "error": "Failed to fetch categories",
                    "details": str(db_error)
                }
            )
---


## MODELS

### filter_model.py
// Path: models/filter_model.py

from pydantic import BaseModel, Field
from typing import List, Optional
from models.product_model import ProductModel

class FilterRequestModel(BaseModel):
    """
    Filter request model for product filtering
    """
    category: Optional[str] = Field(
        None,
        description="Filter by specific category"
    )
    min_price: Optional[float] = Field(
        None,
        ge=0,
        description="Minimum price filter"
    )
    max_price: Optional[float] = Field(
        None,
        ge=0,
        description="Maximum price filter"
    )

class FilterResponseModel(BaseModel):
    """
    Filter response model
    """
    products: List[ProductModel]  # List of filtered products
    total_count: int  # Total number of products after filtering
    applied_filters: dict  # Dictionary of applied filters

class FilterErrorResponseModel(BaseModel):
    """
    Error response model for filter operations
    """
    error: str  # Error message
    details: Optional[str] = None  # Optional detailed error information
---

### product_model.py
// Path: models/product_model.py

from pydantic import BaseModel, Field
from typing import List, Optional
import uuid

class ProductModel(BaseModel):
    """Model representing a product."""
    product_id: str = Field(default_factory=lambda: str(uuid.uuid4()))  # Unique product identifier
    name: str = Field(..., min_length=1, max_length=100)  # Product name
    price: float = Field(..., gt=0)  # Product price, must be greater than 0
    category: str = Field(..., min_length=1, max_length=50)  # Product category
    image_url: str  # URL to product image
    description: str  # Product description
    stock_quantity: int = Field(..., ge=0)  # Available stock, non-negative
    is_available: bool = True  # Availability status

class SearchRequestModel(BaseModel):
    """Model for search request parameters."""
    query: str = Field(..., min_length=1, description="Product name or category to search")  # Search query string
    category: Optional[str] = Field(None, description="Filter by specific category")  # Optional category filter
    min_price: Optional[float] = Field(None, ge=0, description="Minimum price filter")  # Optional min price
    max_price: Optional[float] = Field(None, ge=0, description="Maximum price filter")  # Optional max price

class SearchResponseModel(BaseModel):
    """Model for search response."""
    products: List[ProductModel]  # List of search result products
    total_count: int  # Total number of results
    search_query: str  # The original search query

class ErrorResponseModel(BaseModel):
    """Model for error responses."""
    error: str  # Error message
    details: Optional[str] = None  # Optional details
---

### product.py
// Path: models/product.py

# models/product.py
from pydantic import BaseModel, Field
from typing import Optional


class Product(BaseModel):
    id: int = Field(..., gt=0)
    name: str = Field(..., min_length=1, max_length=200)
    description: Optional[str] = None
    price: float = Field(..., gt=0)
    category: str = Field(..., min_length=1)
    
    in_stock: bool = True
    image_url: Optional[str] = None
    rating: Optional[float] = Field(default=None, ge=0, le=5)
    stock_quantity: Optional[int] = Field(default=None, ge=0)

    model_config = {
        "from_attributes": True,
        "json_encoders": {
            float: lambda v: round(v, 2) if v is not None else None
        }
    }
---

### tempCodeRunnerFile.py
// Path: models/tempCodeRunnerFile.py

from pydantic import BaseModel, Field
from typing import List, Optional
import uuid

class ProductModel(BaseModel):
    """Model representing a product."""
    product_id: str = Field(default_factory=lambda: str(uuid.uuid4()))  # Unique product identifier
    name: str = Field(..., min_length=1, max_length=100)  # Product name
    price: float = Field(..., gt=0)  # Product price, must be greater than 0
    category: str = Field(..., min_length=1, max_length=50)  # Product category
    image_url: str  # URL to product image
    description: str  # Product description
    stock_quantity: int = Field(..., ge=0)  # Available stock, non-negative
    is_available: bool = True  # Availability status

class SearchRequestModel(BaseModel):
    """Model for search request parameters."""
    query: str = Field(..., min_length=1, description="Product name or category to search")  # Search query string
    category: Optional[str] = Field(None, description="Filter by specific category")  # Optional category filter
    min_price: Optional[float] = Field(None, ge=0, description="Minimum price filter")  # Optional min price
    max_price: Optional[float] = Field(None, ge=0, description="Maximum price filter")  # Optional max price

class SearchResponseModel(BaseModel):
    """Model for search response."""
    products: List[ProductModel]  # List of search result products
    total_count: int  # Total number of results
    search_query: str  # The original search query

class ErrorResponseModel(BaseModel):
    """Model for error responses."""
    error: str  # Error message
    details: Optional[str] = None  # Optional details
---


## SERVICES

### filter_service.py
// Path: services/filter_service.py

from models.product_model import ProductModel
from models.filter_model import FilterRequestModel, FilterResponseModel
from typing import List, Optional


class FilterError(Exception):
    """
    Base exception for filter operations
    """
    pass


class DatabaseConnectionError(FilterError):
    """
    Raised when database operations fail (e.g., connection lost, query error)
    """
    pass


class InvalidFilterInputError(FilterError):
    """
    Raised when filter parameters are logically invalid (e.g., min_price > max_price)
    """
    pass


class FilterService:
    """
    Service layer for product filtering operations
    Performs server-side filtering by category and price range
    """
    
    def __init__(self, product_service):
        """
        Initialize with a ProductService instance to access product data
        """
        self.product_service = product_service
    
    
    def fun_filter_products(
        self, 
        filter_request: FilterRequestModel
    ) -> FilterResponseModel:
        """
        Filter products based on category and price range
        Returns filtered products with total count and applied filters metadata
        """
        try:
            self.fun_validate_filter_input(filter_request)
            
            all_products = self.product_service.fun_get_all_products()
            filtered_products = self.fun_apply_filters(
                products=all_products,
                category_filter=filter_request.category,
                min_price_filter=filter_request.min_price,
                max_price_filter=filter_request.max_price
            )
            
            applied_filters = {
                "category": filter_request.category,
                "min_price": filter_request.min_price,
                "max_price": filter_request.max_price
            }
            
            return FilterResponseModel(
                products=filtered_products,
                total_count=len(filtered_products),
                applied_filters=applied_filters
            )
            
        except InvalidFilterInputError:
            raise
        except Exception as filter_operation_error:
            raise DatabaseConnectionError(
                "Filter operation failed"
            ) from filter_operation_error
    
    
    def fun_validate_filter_input(self, filter_request: FilterRequestModel):
        """
        Validate filter input parameters
        Ensures min_price is not greater than max_price
        """
        if (filter_request.min_price is not None and 
            filter_request.max_price is not None):
            if filter_request.min_price > filter_request.max_price:
                raise InvalidFilterInputError(
                    "Minimum price cannot be greater than maximum price"
                )
    
    
    def fun_apply_filters(
        self,
        products: List[ProductModel],
        category_filter: Optional[str] = None,
        min_price_filter: Optional[float] = None,
        max_price_filter: Optional[float] = None
    ) -> List[ProductModel]:
        """
        Apply category and price filters to products
        Only includes available products (is_available == True)
        Case-insensitive category matching
        """
        filtered_results = []
        
        for product in products:
            if not product.is_available:
                continue
            
            category_match = (
                category_filter is None or 
                category_filter == "" or
                product.category.lower() == category_filter.lower()
            )
            
            price_match = True
            if min_price_filter is not None:
                if product.price < min_price_filter:
                    price_match = False
            if max_price_filter is not None:
                if product.price > max_price_filter:
                    price_match = False
            
            if category_match and price_match:
                filtered_results.append(product)
        
        return filtered_results
    
    
    def fun_get_categories(self) -> List[str]:
        """
        Get all available product categories
        Delegates to ProductService and wraps errors
        """
        try:
            return self.product_service.fun_get_categories()
        except Exception as category_error:
            raise DatabaseConnectionError(
                "Failed to fetch categories"
            ) from category_error
---

### product_service.py
// Path: services/product_service.py

# services/product_service.py
from models.product_model import ProductModel, SearchRequestModel, SearchResponseModel
from typing import List, Optional
import re
import uuid


class ProductSearchError(Exception):
    pass


class DatabaseConnectionError(ProductSearchError):
    pass


class InvalidSearchInputError(ProductSearchError):
    pass


class ProductService:
    
    def __init__(self):
        self.products_database = self.fun_initialize_sample_products()
    
    
    def fun_initialize_sample_products(self) -> List[ProductModel]:
        """
        Initialize sample product data
        """
        return [
            ProductModel(
                name="Fresh Apples",
                price=3.00,
                category="Fruits",
                image_url="https://images.unsplash.com/photo-1568702846914-96b305d2aaeb?w=400&h=300&fit=crop",
                description="Fresh red apples, perfect for snacking",
                stock_quantity=50
            ),
            ProductModel(
                name="Bananas",
                price=1.49,
                category="Fruits", 
                image_url="https://images.unsplash.com/photo-1571771894821-ce9b6c11b08e?w=400&h=300&fit=crop",
                description="Sweet yellow bananas, rich in potassium",
                stock_quantity=35
            ),
            ProductModel(
                name="Carrots",
                price=1.99,
                category="Vegetables",
                image_url="https://images.unsplash.com/photo-1598170845058-78131a90f4bf?w=400&h=300&fit=crop",
                description="Fresh organic carrots, great for cooking",
                stock_quantity=40
            ),
            ProductModel(
                name="Milk",
                price=3.49,
                category="Dairy",
                image_url="https://images.unsplash.com/photo-1559598467-f8b76c8155d0?w=400&h=300&fit=crop",
                description="Fresh whole milk, 1 gallon",
                stock_quantity=25
            ),
            ProductModel(
                name="Bread",
                price=2.99,
                category="Bakery",
                image_url="https://images.unsplash.com/photo-1509440159596-0249088772ff?w=400&h=300&fit=crop",
                description="Fresh whole wheat bread",
                stock_quantity=30
            ),
            ProductModel(
                name="Eggs",
                price=4.99,
                category="Dairy",
                image_url="https://images.unsplash.com/photo-1582722872445-44dc5f7e3c8f?w=400&h=300&fit=crop",
                description="Farm fresh eggs, dozen",
                stock_quantity=20
            ),
            ProductModel(
                name="Chicken Breast",
                price=8.99,
                category="Meat",
                image_url="https://images.unsplash.com/photo-1604503468505-6ff2c5a39d7c?w=400&h=300&fit=crop",
                description="Boneless chicken breast, 1lb",
                stock_quantity=15
            ),
            ProductModel(
                name="Rice",
                price=5.99,
                category="Grains",
                image_url="https://images.unsplash.com/photo-1586201375761-83865001e31c?w=400&h=300&fit=crop",
                description="Long grain white rice, 2lb bag",
                stock_quantity=18
            ),
            ProductModel(
                name="Broccoli",
                price=2.49,
                category="Vegetables",
                image_url="https://images.unsplash.com/photo-1459411621453-7b03977f4b4f?w=400&h=300&fit=crop",
                description="Fresh green broccoli, perfect for salads",
                stock_quantity=22
            ),
            ProductModel(
                name="Orange Juice",
                price=4.49,
                category="Beverages",
                image_url="https://images.unsplash.com/photo-1600271886742-f049cd451bba?w=400&h=300&fit=crop",
                description="100% pure orange juice, 1 liter",
                stock_quantity=28
            ),
            ProductModel(
                name="Potatoes",
                price=2.99,
                category="Vegetables",
                image_url="https://images.unsplash.com/photo-1518977676601-b53f82aba655?w=400&h=300&fit=crop",
                description="Fresh potatoes, 5lb bag",
                stock_quantity=45
            ),
            ProductModel(
                name="Yogurt",
                price=3.29,
                category="Dairy",
                image_url="https://images.unsplash.com/photo-1565958011703-44f9829ba187?w=400&h=300&fit=crop",
                description="Greek yogurt, 32oz",
                stock_quantity=32
            )
        ]
    
    
    def fun_search_products(self, search_request: SearchRequestModel) -> SearchResponseModel:
        """
        Search products based on search criteria
        """
        try:
            self.fun_validate_search_input(search_request.query)
            
            filtered_products = self.fun_perform_search_operation(
                search_query=search_request.query,
                category_filter=search_request.category,
                min_price_filter=search_request.min_price,
                max_price_filter=search_request.max_price
            )
            
            return SearchResponseModel(
                products=filtered_products,
                total_count=len(filtered_products),
                search_query=search_request.query
            )
            
        except InvalidSearchInputError:
            raise
        except Exception as search_operation_error:
            raise DatabaseConnectionError("Search operation failed") from search_operation_error
    
    
    def fun_get_all_products(self) -> List[ProductModel]:
        """
        Get all available products
        """
        try:
            return [product for product in self.products_database if product.is_available]
        except Exception as fetch_error:
            raise DatabaseConnectionError("Failed to fetch products") from fetch_error
    
    
    def fun_validate_search_input(self, search_query: str):
        """
        Validate search input for security
        """
        INVALID_PATTERNS = [r"<.*?>", r"script", r"--", r";"]
        
        for pattern in INVALID_PATTERNS:
            if re.search(pattern, search_query, re.IGNORECASE):
                raise InvalidSearchInputError("Invalid characters in search query")
    
    
    def fun_perform_search_operation(
        self,
        search_query: str,
        category_filter: Optional[str] = None,
        min_price_filter: Optional[float] = None,
        max_price_filter: Optional[float] = None
    ) -> List[ProductModel]:
        """
        Perform the actual search with filters
        """
        search_terms = search_query.lower().split()
        filtered_results = []
        
        for product in self.products_database:
            if not product.is_available:
                continue
            
            # Search in name and category
            product_match = any(
                term in product.name.lower() or term in product.category.lower() 
                for term in search_terms
            )
            
            if not product_match:
                continue
            
            # Apply category filter
            category_match = (
                category_filter is None or 
                product.category.lower() == category_filter.lower()
            )
            
            # Apply price filter
            price_match = True
            if min_price_filter is not None and product.price < min_price_filter:
                price_match = False
            if max_price_filter is not None and product.price > max_price_filter:
                price_match = False
            
            if category_match and price_match:
                filtered_results.append(product)
        
        return filtered_results
    
    
    def fun_get_categories(self) -> List[str]:
        """
        Get all available product categories
        """
        try:
            categories = set(product.category for product in self.products_database)
            return sorted(list(categories))
        except Exception as category_error:
            raise DatabaseConnectionError("Failed to fetch categories") from category_error
---


## VIEWS - HTML

### filter.html
// Path: views/filter.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter Products - Bazar Kori</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- TRY BOTH PATHS - One of these will work -->
    <link rel="stylesheet" href="/static/filter.css">  <!-- Try this first -->
    <!-- <link rel="stylesheet" href="/views/filter.css"> -->  <!-- If above fails, try this -->
    
    <script src="/static/filter.js" defer></script>  <!-- Try this first -->
    <!-- <script src="/views/filter.js" defer></script> -->  <!-- If above fails, try this -->
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <h1 class="logo"><i class="fas fa-shopping-basket"></i> Bazar Kori</h1>
                <p class="tagline">Fresh Groceries Delivered</p>
            </div>
            <nav class="navigation">
                <a href="/" class="nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/filter" class="nav-link active"><i class="fas fa-filter"></i> Browse & Filter</a>
                <a href="#" class="nav-link"><i class="fas fa-user"></i> My Account</a>
                <a href="#" class="nav-link basket-link">
                    <i class="fas fa-shopping-cart"></i> 
                    <span class="cart-count">0</span>
                </a>
            </nav>
            <button class="hamburger-btn" id="hamburgerBtn" aria-label="Open filters">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Sidebar Filter -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-sliders-h"></i> Filter Products</h2>
            <button class="close-btn" id="closeBtn">√ó</button>
        </div>
        
        <div class="filter-section">
            <!-- Search -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-search"></i> Search Products</h3>
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput" 
                        placeholder="Search by name..."
                    >
                </div>
            </div>

            <!-- Category Filter -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-tags"></i> Categories</h3>
                <div class="category-checkboxes" id="categoriesContainer">
                    <!-- Categories will be loaded here -->
                    <div class="skeleton-checkbox"></div>
                    <div class="skeleton-checkbox"></div>
                    <div class="skeleton-checkbox"></div>
                </div>
            </div>

            <!-- Price Range Filter -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-tag"></i> Price Range</h3>
                <div class="price-range">
                    <div class="price-slider">
                        <input 
                            type="range" 
                            class="range-slider" 
                            id="priceSlider" 
                            min="0" 
                            max="100" 
                            value="100"
                        >
                        <div class="slider-labels">
                            <span>$0</span>
                            <span>$50</span>
                            <span>$100+</span>
                        </div>
                    </div>
                    <div class="price-input-group">
                        <div class="price-input-wrapper">
                            <span class="price-label">Min</span>
                            <input 
                                type="number" 
                                class="price-input" 
                                id="minPrice" 
                                placeholder="0" 
                                min="0"
                            >
                        </div>
                        <span class="price-separator">to</span>
                        <div class="price-input-wrapper">
                            <span class="price-label">Max</span>
                            <input 
                                type="number" 
                                class="price-input" 
                                id="maxPrice" 
                                placeholder="100" 
                                min="0"
                            >
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sort Options -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-sort"></i> Sort By</h3>
                <select class="filter-select" id="sortSelect">
                    <option value="default">Recommended</option>
                    <option value="price_low">Price: Low to High</option>
                    <option value="price_high">Price: High to Low</option>
                    <option value="name_asc">Name: A to Z</option>
                    <option value="name_desc">Name: Z to A</option>
                </select>
            </div>

            <!-- Stock Filter -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-box"></i> Availability</h3>
                <div class="availability-filter">
                    <label class="checkbox-label">
                        <input type="checkbox" id="inStockOnly" checked>
                        <span class="checkmark"></span>
                        Show in-stock only
                    </label>
                </div>
            </div>

            <!-- Filter Actions -->
            <div class="filter-actions">
                <button class="apply-btn" id="applyFilters">
                    <i class="fas fa-check"></i> Apply Filters
                </button>
                <button class="reset-btn" id="resetFilters">
                    <i class="fas fa-redo"></i> Reset All
                </button>
            </div>
        </div>
    </aside>

    <!-- Overlay -->
    <div class="overlay hidden" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-top">
                    <h2 class="page-title">Fresh Grocery Products</h2>
                    <button class="filter-toggle-btn" id="filterToggleBtn">
                        <i class="fas fa-filter"></i> Filters
                    </button>
                </div>
                <p class="page-subtitle">
                    Browse our fresh selection of groceries. Filter by category, price, and more.
                </p>
                <div class="active-filters" id="activeFilters">
                    <!-- Active filters will appear here -->
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section">
                <div class="results-header">
                    <div>
                        <h3 id="resultsTitle">All Products</h3>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid"><i class="fas fa-th"></i></button>
                            <button class="view-btn" data-view="list"><i class="fas fa-list"></i></button>
                        </div>
                    </div>
                    <div class="results-info">
                        <span class="results-count" id="resultsCount">0 products</span>
                        <span class="results-time" id="resultsTime"></span>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <p>Loading fresh products...</p>
                </div>

                <!-- Messages -->
                <div class="no-results hidden" id="noResultsMessage">
                    <i class="fas fa-search fa-3x"></i>
                    <h3>No products match your filters</h3>
                    <p>Try adjusting your search or browse all categories</p>
                    <button class="clear-btn" id="clearAllFilters">Clear All Filters</button>
                </div>

                <div class="error-message hidden" id="errorMessage">
                    <i class="fas fa-exclamation-triangle fa-3x"></i>
                    <h3>Unable to load products</h3>
                    <p>Please check your connection and try again</p>
                    <button class="retry-btn" id="retryBtn">Retry</button>
                </div>

                <!-- Products Grid -->
                <div class="products-grid grid-view" id="productsGrid">
                    <!-- Products will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Cart Notification -->
    <div class="cart-notification hidden" id="cartNotification">
        <i class="fas fa-check-circle"></i>
        <span>Added to cart!</span>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-shopping-basket"></i> Bazar Kori</h3>
                    <p>Fresh groceries delivered to your doorstep</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="/">Home</a>
                    <a href="/filter">Browse Products</a>
                    <a href="#">About Us</a>
                    <a href="#">Contact</a>
                </div>
                <div class="footer-section">
                    <h4>Categories</h4>
                    <a href="#">Vegetables</a>
                    <a href="#">Fruits</a>
                    <a href="#">Meat</a>
                    <a href="#">Dairy</a>
                </div>
            </div>
            <p class="copyright">&copy; 2025 Bazar Kori. All rights reserved.</p>
        </div>
    </footer>
</body>
</html>
---

### search.html
// Path: views/search.html

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Products - Bazar Kori</title>
    <link rel="stylesheet" href="/static/search.css">
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <h1 class="logo">Bazar Kori</h1>
            </div>
            <nav class="navigation">
                <a href="#" class="nav-link">Home</a>
                <a href="/filter" class="nav-link">Browse & Filter</a>
                <a href="#" class="nav-link">My Account</a>
                <a href="#" class="nav-link basket-link">Basket(2)</a>
            </nav>
        </div>
    </header>

    <!-- Main Search Section -->
    <main class="main-content">
        <div class="container">
            <!-- Search Header -->
            <div class="search-header">
                <h2 class="page-title">Search Products</h2>
                <p class="page-subtitle">Find your desired products quickly and easily</p>
            </div>

            <!-- Search Form -->
            <div class="search-section">
                <div class="search-form-container">
                    <form id="searchForm" class="search-form">
                        <div class="search-input-group">
                            <input 
                                type="text" 
                                id="searchInput" 
                                class="search-input" 
                                placeholder="Enter product name or category..."
                                aria-label="Search products"
                            >
                            <button type="submit" class="search-button" id="searchButton">
                                <span class="search-icon">üîç</span>
                                Search
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Filters Section -->
                <div class="filters-section">
                    <div class="filter-group">
                        <label for="categoryFilter" class="filter-label">Category:</label>
                        <select id="categoryFilter" class="filter-select">
                            <option value="">All Categories</option>
                            <!-- Categories will be loaded dynamically -->
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="minPrice" class="filter-label">Price Range:</label>
                        <div class="price-range-group">
                            <input 
                                type="number" 
                                id="minPrice" 
                                class="price-input" 
                                placeholder="Min" 
                                min="0"
                            >
                            <span class="price-separator">-</span>
                            <input 
                                type="number" 
                                id="maxPrice" 
                                class="price-input" 
                                placeholder="Max" 
                                min="0"
                            >
                        </div>
                    </div>

                    <button type="button" id="applyFilters" class="filter-button">
                        Apply Filters
                    </button>
                    <button type="button" id="resetFilters" class="filter-button secondary">
                        Reset
                    </button>
                </div>
            </div>

            <!-- Search Results Section -->
            <div class="results-section">
                <div id="loadingSpinner" class="loading-spinner hidden">
                    <div class="spinner"></div>
                    <p>Searching products...</p>
                </div>

                <div id="resultsContainer" class="results-container">
                    <div id="noResultsMessage" class="no-results hidden">
                        <h3>No products found</h3>
                        <p>Try adjusting your search terms or filters</p>
                    </div>

                    <div id="emptySearchMessage" class="empty-search hidden">
                        <h3>Please enter a search term</h3>
                        <p>Enter a product name or category to start searching</p>
                    </div>

                    <div id="errorMessage" class="error-message hidden">
                        <h3>Unable to load search results</h3>
                        <p>Please check your connection and try again later</p>
                    </div>

                    <div id="productsGrid" class="products-grid"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Bazar Kori. All rights reserved.</p>
        </div>
    </footer>

    <script src="/static/search.js"></script>
</body>
</html>
---


## VIEWS - CSS

### filter.css
// Path: views/filter.css

/* CSS Variables - Enhanced Color Scheme */
:root {
    --primary-color: #4CAF50;
    --primary-dark: #388E3C;
    --primary-light: #C8E6C9;
    --secondary-color: #FF9800;
    --secondary-dark: #F57C00;
    --secondary-light: #FFE0B2;
    --accent-color: #2196F3;
    --success-color: #4CAF50;
    --warning-color: #FFC107;
    --error-color: #F44336;
    --text-color: #333333;
    --text-light: #666666;
    --text-lighter: #999999;
    --bg-color: #F9F9F9;
    --bg-light: #FFFFFF;
    --border-color: #E0E0E0;
    --border-light: #EEEEEE;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-light: 0 2px 8px rgba(0, 0, 0, 0.05);
    --radius: 12px;
    --radius-sm: 8px;
    --radius-lg: 16px;
    --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    --sidebar-width: 320px;
    --header-height: 80px;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    color: var(--text-color);
    background-color: var(--bg-color);
    -webkit-font-smoothing: antialiased;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 24px;
}

/* Header Styles */
.header {
    background-color: var(--bg-light);
    box-shadow: var(--shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
    height: var(--header-height);
    display: flex;
    align-items: center;
}

.header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    width: 100%;
}

.logo-section {
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.logo {
    color: var(--primary-color);
    font-size: 28px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 10px;
}

.logo i {
    font-size: 32px;
}

.tagline {
    color: var(--text-light);
    font-size: 14px;
    font-weight: 400;
}

.navigation {
    display: flex;
    gap: 32px;
    align-items: center;
}

.nav-link {
    text-decoration: none;
    color: var(--text-color);
    font-weight: 500;
    font-size: 16px;
    padding: 8px 0;
    position: relative;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: var(--transition);
}

.nav-link:hover {
    color: var(--primary-color);
}

.nav-link.active {
    color: var(--primary-color);
}

.nav-link.active::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 0;
    width: 100%;
    height: 2px;
    background-color: var(--primary-color);
    border-radius: 1px;
}

.basket-link {
    background-color: var(--primary-color);
    color: white;
    padding: 10px 20px;
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    gap: 8px;
    font-weight: 600;
    transition: var(--transition);
}

.basket-link:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
    color: white;
}

.cart-count {
    background-color: var(--secondary-color);
    color: white;
    font-size: 12px;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-left: 4px;
}

/* Hamburger Button */
.hamburger-btn {
    display: none;
    flex-direction: column;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    border-radius: var(--radius-sm);
    transition: var(--transition);
}

.hamburger-btn:hover {
    background-color: var(--border-light);
}

.hamburger-btn span {
    width: 24px;
    height: 2px;
    background-color: var(--text-color);
    margin: 3px 0;
    transition: var(--transition);
    border-radius: 1px;
}

/* Sidebar Styles */
.sidebar {
    position: fixed;
    top: 0;
    right: calc(-1 * var(--sidebar-width));
    width: var(--sidebar-width);
    height: 100vh;
    background-color: var(--bg-light);
    box-shadow: -2px 0 20px rgba(0, 0, 0, 0.1);
    transition: var(--transition);
    z-index: 1001;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

.sidebar.active {
    right: 0;
}

.sidebar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 24px;
    border-bottom: 1px solid var(--border-light);
    background-color: var(--bg-light);
    position: sticky;
    top: 0;
    z-index: 1;
}

.sidebar-header h2 {
    color: var(--text-color);
    font-size: 20px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.close-btn {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: var(--text-light);
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: var(--transition);
}

.close-btn:hover {
    background-color: var(--border-light);
    color: var(--error-color);
}

.filter-section {
    padding: 24px;
    flex: 1;
}

.filter-group {
    margin-bottom: 32px;
}

.filter-title {
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 16px;
    color: var(--text-color);
    display: flex;
    align-items: center;
    gap: 10px;
}

.filter-title i {
    color: var(--primary-color);
    font-size: 14px;
    width: 20px;
}

/* Search Box */
.search-box {
    position: relative;
}

.search-icon {
    position: absolute;
    left: 16px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-lighter);
}

.search-input {
    width: 100%;
    padding: 12px 16px 12px 48px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    font-size: 15px;
    transition: var(--transition);
    background-color: var(--bg-light);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px var(--primary-light);
}

/* Category Checkboxes */
.category-checkboxes {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    padding: 12px;
    border-radius: var(--radius-sm);
    transition: var(--transition);
    user-select: none;
}

.checkbox-label:hover {
    background-color: var(--border-light);
}

.checkbox-label input {
    display: none;
}

.checkmark {
    width: 20px;
    height: 20px;
    border: 2px solid var(--border-color);
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: var(--transition);
}

.checkbox-label input:checked + .checkmark {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}

.checkbox-label input:checked + .checkmark::after {
    content: '‚úì';
    color: white;
    font-size: 12px;
    font-weight: bold;
}

/* Price Range */
.price-range {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.price-slider {
    padding: 8px 0;
}

.range-slider {
    width: 100%;
    height: 4px;
    border-radius: 2px;
    background: var(--border-color);
    outline: none;
    -webkit-appearance: none;
}

.range-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
    border: 2px solid white;
    box-shadow: var(--shadow);
}

.range-slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: var(--primary-color);
    cursor: pointer;
    border: 2px solid white;
    box-shadow: var(--shadow);
}

.slider-labels {
    display: flex;
    justify-content: space-between;
    margin-top: 8px;
    color: var(--text-lighter);
    font-size: 12px;
}

.price-input-group {
    display: flex;
    align-items: center;
    gap: 16px;
}

.price-input-wrapper {
    flex: 1;
    position: relative;
}

.price-label {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-lighter);
    font-size: 14px;
}

.price-input {
    width: 100%;
    padding: 12px 12px 12px 40px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    font-size: 15px;
    transition: var(--transition);
}

.price-input:focus {
    outline: none;
    border-color: var(--primary-color);
}

.price-separator {
    color: var(--text-lighter);
    font-weight: 500;
}

/* Filter Select */
.filter-select {
    width: 100%;
    padding: 12px 16px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    font-size: 15px;
    background-color: var(--bg-light);
    cursor: pointer;
    transition: var(--transition);
    appearance: none;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23666' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 16px center;
    padding-right: 40px;
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px var(--primary-light);
}

/* Filter Actions */
.filter-actions {
    display: flex;
    gap: 12px;
    margin-top: 32px;
    padding-top: 20px;
    border-top: 1px solid var(--border-light);
}

.apply-btn,
.reset-btn {
    flex: 1;
    padding: 14px 20px;
    border: none;
    border-radius: var(--radius-sm);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.apply-btn {
    background-color: var(--primary-color);
    color: white;
}

.apply-btn:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
}

.reset-btn {
    background-color: var(--bg-light);
    color: var(--text-color);
    border: 1px solid var(--border-color);
}

.reset-btn:hover {
    background-color: var(--border-light);
    transform: translateY(-2px);
}

/* Overlay */
.overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 999;
    opacity: 0;
    visibility: hidden;
    transition: var(--transition);
}

.overlay.active {
    opacity: 1;
    visibility: visible;
}

/* Main Content */
.main-content {
    padding: 40px 0;
    min-height: calc(100vh - var(--header-height) - 200px);
}

.page-header {
    margin-bottom: 32px;
}

.header-top {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
}

.page-title {
    font-size: 32px;
    color: var(--text-color);
    font-weight: 700;
}

.page-subtitle {
    color: var(--text-light);
    font-size: 16px;
    margin-bottom: 24px;
}

.active-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 16px;
}

.filter-tag {
    background-color: var(--primary-light);
    color: var(--primary-dark);
    padding: 6px 12px;
    border-radius: 16px;
    font-size: 14px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.filter-tag .remove {
    background: none;
    border: none;
    color: inherit;
    cursor: pointer;
    font-size: 12px;
    padding: 0;
    width: 16px;
    height: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.filter-tag .remove:hover {
    background-color: rgba(0, 0, 0, 0.1);
}

.filter-toggle-btn {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius-sm);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
}

.filter-toggle-btn:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
    box-shadow: var(--shadow);
}

/* Results Section */
.results-section {
    background: var(--bg-light);
    padding: 32px;
    border-radius: var(--radius);
    box-shadow: var(--shadow-light);
}

.results-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 1px solid var(--border-light);
}

.results-header > div {
    display: flex;
    align-items: center;
    gap: 20px;
}

.results-header h3 {
    color: var(--text-color);
    font-size: 24px;
    font-weight: 600;
}

.view-toggle {
    display: flex;
    gap: 4px;
    background-color: var(--border-light);
    padding: 4px;
    border-radius: var(--radius-sm);
}

.view-btn {
    background: none;
    border: none;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    cursor: pointer;
    color: var(--text-light);
    transition: var(--transition);
}

.view-btn:hover {
    background-color: var(--bg-light);
}

.view-btn.active {
    background-color: var(--bg-light);
    color: var(--primary-color);
    box-shadow: var(--shadow-light);
}

.results-info {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
    gap: 4px;
}

.results-count {
    color: var(--text-color);
    font-weight: 600;
    font-size: 14px;
}

.results-time {
    color: var(--text-lighter);
    font-size: 12px;
}

/* Loading Spinner */
.loading-spinner {
    text-align: center;
    padding: 60px 20px;
}

.spinner {
    border: 3px solid var(--border-light);
    border-left: 3px solid var(--primary-color);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 0 auto 20px;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Messages */
.no-results,
.error-message {
    text-align: center;
    padding: 60px 20px;
    color: var(--text-light);
}

.no-results i,
.error-message i {
    color: var(--border-color);
    margin-bottom: 20px;
}

.no-results h3,
.error-message h3 {
    color: var(--text-color);
    margin-bottom: 12px;
    font-size: 20px;
}

.clear-btn,
.retry-btn {
    margin-top: 20px;
    padding: 12px 24px;
    background-color: var(--primary-color);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
}

.clear-btn:hover,
.retry-btn:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
}

/* Products Grid */
.products-grid {
    display: grid;
    gap: 24px;
    opacity: 1;
    transition: opacity 0.3s ease;
}

.products-grid.loading {
    opacity: 0.5;
}

.grid-view {
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
}

.list-view {
    grid-template-columns: 1fr;
}

/* Product Card */
.product-card {
    background: var(--bg-light);
    border-radius: var(--radius);
    overflow: hidden;
    transition: var(--transition);
    border: 1px solid var(--border-light);
    position: relative;
}

.product-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow);
    border-color: var(--primary-light);
}

.product-image {
    width: 100%;
    height: 200px;
    background: linear-gradient(135deg, var(--primary-light) 0%, var(--bg-light) 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    position: relative;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.product-card:hover .product-image img {
    transform: scale(1.05);
}

.image-placeholder {
    color: var(--primary-color);
    font-size: 48px;
}

.product-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    background-color: var(--secondary-color);
    color: white;
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 12px;
    font-weight: 600;
}

.product-info {
    padding: 20px;
}

.product-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 12px;
}

.product-name {
    font-size: 18px;
    font-weight: 600;
    color: var(--text-color);
    line-height: 1.4;
    flex: 1;
}

.product-favorite {
    background: none;
    border: none;
    color: var(--border-color);
    font-size: 20px;
    cursor: pointer;
    transition: var(--transition);
    padding: 4px;
}

.product-favorite:hover {
    color: var(--error-color);
}

.product-favorite.active {
    color: var(--error-color);
}

.product-category {
    color: var(--text-light);
    font-size: 14px;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.product-category i {
    font-size: 12px;
}

.product-description {
    color: var(--text-light);
    font-size: 14px;
    line-height: 1.5;
    margin-bottom: 16px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.product-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 16px;
}

.product-price {
    font-size: 24px;
    font-weight: 700;
    color: var(--primary-color);
}

.price-unit {
    font-size: 14px;
    color: var(--text-light);
    font-weight: 400;
}

.product-stock {
    font-size: 12px;
    padding: 4px 8px;
    border-radius: 10px;
    font-weight: 600;
}

.stock-available {
    background-color: #E8F5E9;
    color: var(--success-color);
}

.stock-low {
    background-color: #FFF3E0;
    color: var(--warning-color);
}

.stock-out {
    background-color: #FFEBEE;
    color: var(--error-color);
}

.add-to-cart {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: var(--radius-sm);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    justify-content: center;
    margin-top: 16px;
}

.add-to-cart:hover {
    background-color: var(--primary-dark);
    transform: translateY(-2px);
}

.add-to-cart:disabled {
    background-color: var(--border-color);
    cursor: not-allowed;
    transform: none;
}

.add-to-cart i {
    font-size: 14px;
}

/* Cart Notification */
.cart-notification {
    position: fixed;
    bottom: 24px;
    right: 24px;
    background-color: var(--success-color);
    color: white;
    padding: 16px 24px;
    border-radius: var(--radius);
    box-shadow: var(--shadow);
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 1002;
    transform: translateY(100px);
    opacity: 0;
    transition: var(--transition);
}

.cart-notification.show {
    transform: translateY(0);
    opacity: 1;
}

.cart-notification i {
    font-size: 20px;
}

/* Footer */
.footer {
    background-color: var(--text-color);
    color: white;
    padding: 60px 0 30px;
    margin-top: 60px;
}

.footer-content {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 40px;
    margin-bottom: 40px;
}

.footer-section h3,
.footer-section h4 {
    color: white;
    margin-bottom: 20px;
    font-size: 18px;
}

.footer-section h3 i {
    margin-right: 10px;
    color: var(--primary-color);
}

.footer-section p {
    color: #CCCCCC;
    line-height: 1.6;
    margin-bottom: 20px;
}

.footer-section a {
    display: block;
    color: #CCCCCC;
    text-decoration: none;
    margin-bottom: 12px;
    transition: var(--transition);
}

.footer-section a:hover {
    color: var(--primary-color);
    padding-left: 4px;
}

.copyright {
    text-align: center;
    padding-top: 30px;
    border-top: 1px solid rgba(255, 255, 255, 0.1);
    color: #999999;
    font-size: 14px;
}

/* Skeleton Loading */
.skeleton-checkbox {
    height: 44px;
    background: linear-gradient(90deg, var(--border-light) 25%, var(--bg-light) 50%, var(--border-light) 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: var(--radius-sm);
}

.skeleton-card {
    height: 350px;
    background: linear-gradient(90deg, var(--border-light) 25%, var(--bg-light) 50%, var(--border-light) 75%);
    background-size: 200% 100%;
    animation: loading 1.5s infinite;
    border-radius: var(--radius);
}

@keyframes loading {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
}

/* Utility Classes */
.hidden {
    display: none !important;
}

/* Responsive Design */
@media (max-width: 1024px) {
    .grid-view {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    }
}

@media (max-width: 768px) {
    .header .container {
        padding: 0 16px;
    }
    
    .navigation {
        display: none;
    }
    
    .hamburger-btn {
        display: flex;
    }
    
    .sidebar {
        width: 100%;
        right: -100%;
    }
    
    .filter-actions {
        flex-direction: column;
    }
    
    .price-input-group {
        flex-direction: column;
        align-items: stretch;
    }
    
    .grid-view {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    }
    
    .results-header {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
    }
    
    .results-header > div {
        justify-content: space-between;
    }
    
    .results-info {
        align-items: flex-start;
    }
}

@media (max-width: 480px) {
    .grid-view {
        grid-template-columns: 1fr;
    }
    
    .product-card {
        max-width: 100%;
    }
    
    .footer-content {
        grid-template-columns: 1fr;
    }
}
---

### search.css
// Path: views/search.css

/* CSS Variables */
:root {
    --primary-color: #2c5aa0;
    --secondary-color: #f8f9fa;
    --accent-color: #ff6b35;
    --text-color: #333;
    --text-light: #666;
    --border-color: #ddd;
    --success-color: #28a745;
    --error-color: #dc3545;
    --warning-color: #ffc107;
    --border-radius: 8px;
    --box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    --transition: all 0.3s ease;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    line-height: 1.6;
    color: var(--text-color);
    background-color: #f5f5f5;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

/* Header Styles */
.header {
    background-color: white;
    box-shadow: var(--box-shadow);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header .container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem 20px;
}

.logo {
    color: var(--primary-color);
    font-size: 1.8rem;
    font-weight: bold;
}

.navigation {
    display: flex;
    gap: 2rem;
    align-items: center;
}

.nav-link {
    text-decoration: none;
    color: var(--text-color);
    font-weight: 500;
    transition: var(--transition);
}

.nav-link:hover {
    color: var(--primary-color);
}

.basket-link {
    background-color: var(--accent-color);
    color: white;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
}

/* Main Content */
.main-content {
    padding: 2rem 0;
    min-height: calc(100vh - 140px);
}

.search-header {
    text-align: center;
    margin-bottom: 2rem;
}

.page-title {
    font-size: 2.5rem;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.page-subtitle {
    color: var(--text-light);
    font-size: 1.1rem;
}

/* Search Form */
.search-section {
    background: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
    margin-bottom: 2rem;
}

.search-input-group {
    display: flex;
    gap: 0.5rem;
    max-width: 600px;
    margin: 0 auto;
}

.search-input {
    flex: 1;
    padding: 0.75rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--border-radius);
    font-size: 1rem;
    transition: var(--transition);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
}

.search-button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: var(--border-radius);
    font-size: 1rem;
    cursor: pointer;
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.search-button:hover {
    background-color: #1e3d6f;
}

.search-icon {
    font-size: 1.1rem;
}

/* Filters Section */
.filters-section {
    display: flex;
    gap: 1rem;
    margin-top: 1rem;
    flex-wrap: wrap;
    align-items: flex-end;
    justify-content: center;
}

.filter-group {
    display: flex;
    flex-direction: column;
    min-width: 150px;
}

.filter-label {
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
    color: var(--text-light);
}

.filter-select,
.price-input {
    padding: 0.5rem;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background: white;
}

.price-range-group {
    display: flex;
    gap: 0.5rem;
    align-items: center;
}

.price-separator {
    color: var(--text-light);
}

.filter-button {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius);
    cursor: pointer;
    transition: var(--transition);
}

.filter-button:hover {
    background-color: #1e3d6f;
}

.filter-button.secondary {
    background-color: var(--secondary-color);
    color: var(--text-color);
    border: 1px solid var(--border-color);
}

.filter-button.secondary:hover {
    background-color: #e9ecef;
}

/* Results Section */
.results-section {
    background: white;
    padding: 2rem;
    border-radius: var(--border-radius);
    box-shadow: var(--box-shadow);
}

.loading-spinner {
    text-align: center;
    padding: 2rem;
}

.spinner {
    border: 4px solid var(--border-color);
    border-left: 4px solid var(--primary-color);
    border-radius: 50%;
    width: 40px;
    height: 40px;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.no-results,
.error-message {
    text-align: center;
    padding: 3rem;
    color: var(--text-light);
}

.no-results h3,
.error-message h3 {
    color: var(--text-color);
    margin-bottom: 0.5rem;
}

/* Products Grid */
.products-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
}

.product-card {
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    overflow: hidden;
    transition: var(--transition);
    background: white;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: var(--box-shadow);
}

.product-image {
    width: 100%;
    height: 200px;
    background-color: var(--secondary-color);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-light);
    font-size: 3rem;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.product-info {
    padding: 1rem;
}

.product-name {
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--text-color);
}

.product-category {
    color: var(--text-light);
    font-size: 0.9rem;
    margin-bottom: 0.5rem;
}

.product-price {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.product-description {
    font-size: 0.9rem;
    color: var(--text-light);
    margin-bottom: 0.5rem;
}

.product-stock {
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.8rem;
}

.stock-available {
    background-color: var(--success-color);
    color: white;
}

.stock-low {
    background-color: var(--warning-color);
    color: white;
}

/* Footer */
.footer {
    background-color: var(--text-color);
    color: white;
    text-align: center;
    padding: 1rem 0;
    margin-top: 2rem;
}

/* Utility Classes */
.hidden {
    display: none !important;
}

/* Responsive Design */
@media (max-width: 768px) {
    .header .container {
        flex-direction: column;
        gap: 1rem;
    }
    
    .navigation {
        gap: 1rem;
    }
    
    .search-input-group {
        flex-direction: column;
    }
    
    .filters-section {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-group {
        width: 100%;
    }
    
    .products-grid {
        grid-template-columns: 1fr;
    }
}
---


## VIEWS - JAVASCRIPT

### filter.js
// Path: views/filter.js

// filter.js - UPDATED FOR YOUR FASTAPI BACKEND
/**
 * Main client-side application for the advanced product filtering page (/filter)
 * Handles real-time filtering, sorting, searching, category selection, price range,
 * cart counter, favorites, responsive sidebar and full integration with FastAPI backend.
 */
document.addEventListener('DOMContentLoaded', function() {
    initFilterApp();
});

// Global application state
let filterState = {
    categories: [],
    minPrice: 0,
    maxPrice: 100,
    searchQuery: '',
    sortBy: 'default',
    inStockOnly: true,
    cart: [],
    cartCount: 0
};

/**
 * Application entry point ‚Äì initializes everything
 */
function initFilterApp() {
    loadInitialData();
    setupEventListeners();
    updateCartCount();
}

/**
 * Loads categories and products when the page first loads
 */
async function loadInitialData() {
    showLoading(true);
    
    try {
        const [categories, productsResponse] = await Promise.all([
            fetchCategories(),
            fetchFilteredProducts()
        ]);
        
        filterState.categories = categories.map(cat => ({
            id: cat.id,
            name: cat.name,
            selected: true,
            icon: cat.icon
        }));
        
        populateCategories();
        displayProducts(productsResponse);
        updateResultsInfo(productsResponse.total_count || productsResponse.products?.length || 0, 'loaded');
        
        const products = productsResponse.products || productsResponse || [];
        initializePriceSlider(products);
        
    } catch (error) {
        console.error('Failed to load initial data:', error);
        showErrorMessage('Failed to load products. Please try again.');
    } finally {
        showLoading(false);
    }
}

/**
 * Registers all event listeners for interactive elements
 */
function setupEventListeners() {
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const closeBtn = document.getElementById('closeBtn');
    const filterToggleBtn = document.getElementById('filterToggleBtn');
    const overlay = document.getElementById('overlay');
    
    if (hamburgerBtn) hamburgerBtn.addEventListener('click', toggleSidebar);
    if (closeBtn) closeBtn.addEventListener('click', toggleSidebar);
    if (filterToggleBtn) filterToggleBtn.addEventListener('click', toggleSidebar);
    if (overlay) overlay.addEventListener('click', toggleSidebar);
    
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                filterState.searchQuery = e.target.value.trim();
                applyFilters();
            }, 500);
        });
    }
    
    const priceSlider = document.getElementById('priceSlider');
    if (priceSlider) {
        priceSlider.addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('maxPrice').value = value;
            filterState.maxPrice = parseInt(value);
            updateActiveFilters();
        });
    }
    
    const minPriceInput = document.getElementById('minPrice');
    const maxPriceInput = document.getElementById('maxPrice');
    
    if (minPriceInput) {
        minPriceInput.addEventListener('change', (e) => {
            filterState.minPrice = parseInt(e.target.value) || 0;
            applyFilters();
        });
    }
    
    if (maxPriceInput) {
        maxPriceInput.addEventListener('change', (e) => {
            filterState.maxPrice = parseInt(e.target.value) || 100;
            applyFilters();
        });
    }
    
    const sortSelect = document.getElementById('sortSelect');
    if (sortSelect) {
        sortSelect.addEventListener('change', (e) => {
            filterState.sortBy = e.target.value;
            applyFilters();
        });
    }
    
    const inStockCheckbox = document.getElementById('inStockOnly');
    if (inStockCheckbox) {
        inStockCheckbox.addEventListener('change', (e) => {
            filterState.inStockOnly = e.target.checked;
            applyFilters();
        });
    }
    
    const applyBtn = document.getElementById('applyFilters');
    const resetBtn = document.getElementById('resetFilters');
    const clearAllBtn = document.getElementById('clearAllFilters');
    const retryBtn = document.getElementById('retryBtn');
    
    if (applyBtn) applyBtn.addEventListener('click', applyFilters);
    if (resetBtn) resetBtn.addEventListener('click', resetFilters);
    if (clearAllBtn) clearAllBtn.addEventListener('click', resetFilters);
    if (retryBtn) retryBtn.addEventListener('click', loadInitialData);
    
    const viewButtons = document.querySelectorAll('.view-btn');
    viewButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
            const view = e.target.dataset.view || e.target.closest('.view-btn').dataset.view;
            setViewMode(view);
        });
    });
    
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('add-to-cart') || 
            e.target.closest('.add-to-cart')) {
            const button = e.target.classList.contains('add-to-cart') 
                ? e.target 
                : e.target.closest('.add-to-cart');
            const productId = button.dataset.productId;
            if (productId) handleAddToCart(productId);
        }
        
        if (e.target.classList.contains('remove-filter') || 
            e.target.closest('.remove-filter')) {
            const button = e.target.classList.contains('remove-filter') 
                ? e.target 
                : e.target.closest('.remove-filter');
            const filterType = button.dataset.filterType;
            const filterValue = button.dataset.filterValue;
            removeFilter(filterType, filterValue);
        }
        
        if (e.target.classList.contains('product-favorite') || 
            e.target.closest('.product-favorite')) {
            const button = e.target.classList.contains('product-favorite') 
                ? e.target 
                : e.target.closest('.product-favorite');
            toggleFavorite(button);
        }
    });
}

/**
 * Toggles the mobile filter sidebar
 */
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
    
    if (hamburgerBtn) {
        const spans = hamburgerBtn.querySelectorAll('span');
        if (sidebar.classList.contains('active')) {
            spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
            spans[1].style.opacity = '0';
            spans[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
        } else {
            spans[0].style.transform = 'none';
            spans[1].style.opacity = '1';
            spans[2].style.transform = 'none';
        }
    }
}

/**
 * Fetches the list of available categories from the backend
 * @returns {Promise<Array>} Array of category objects with id, name, icon
 */
async function fetchCategories() {
    try {
        const response = await fetch('/api/v1/filter/categories');
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        const categories = await response.json();
        return categories.map(categoryName => ({
            id: categoryName.toLowerCase().replace(/\s+/g, '_'),
            name: categoryName,
            icon: getCategoryIcon(categoryName)
        }));
    } catch (error) {
        console.error('Error fetching categories:', error);
        return [
            { id: 'fruits', name: 'Fruits', icon: 'fas fa-apple-alt' },
            { id: 'vegetables', name: 'Vegetables', icon: 'fas fa-carrot' },
            { id: 'dairy', name: 'Dairy', icon: 'fas fa-egg' },
            { id: 'bakery', name: 'Bakery', icon: 'fas fa-bread-slice' },
            { id: 'meat', name: 'Meat', icon: 'fas fa-drumstick-bite' },
            { id: 'grains', name: 'Grains', icon: 'fas fa-seedling' },
            { id: 'beverages', name: 'Beverages', icon: 'fas fa-wine-bottle' }
        ];
    }
}

/**
 * Calls the backend filter endpoint with current filter state
 * @returns {Promise<Object>} Filtered products response
 */
async function fetchFilteredProducts() {
    try {
        const params = new URLSearchParams();
        
        const selectedCategories = filterState.categories
            .filter(cat => cat.selected)
            .map(cat => cat.name);
        
        if (selectedCategories.length > 0) {
            params.append('category', selectedCategories[0]);
        }
        
        if (filterState.minPrice > 0) {
            params.append('min_price', filterState.minPrice);
        }
        
        if (filterState.maxPrice < 100) {
            params.append('max_price', filterState.maxPrice);
        }
        
        if (filterState.searchQuery) {
            params.append('search', filterState.searchQuery);
        }
        
        if (filterState.sortBy !== 'default') {
            params.append('sort', filterState.sortBy);
        }
        
        const apiUrl = `/api/v1/filter?${params.toString()}`;
        console.log('Fetching from API:', apiUrl);
        
        const response = await fetch(apiUrl);
        
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        
        return await response.json();
        
    } catch (error) {
        console.error('Error fetching filtered products:', error);
        throw error;
    }
}

/**
 * Returns the appropriate FontAwesome icon class for a category
 * @param {string} categoryName 
 * @returns {string} Icon class
 */
function getCategoryIcon(categoryName) {
    const iconMap = {
        'Fruits': 'fas fa-apple-alt',
        'Vegetables': 'fas fa-carrot',
        'Dairy': 'fas fa-egg',
        'Bakery': 'fas fa-bread-slice',
        'Meat': 'fas fa-drumstick-bite',
        'Grains': 'fas fa-seedling',
        'Beverages': 'fas fa-wine-bottle'
    };
    return iconMap[categoryName] || 'fas fa-tag';
}

/**
 * Renders category checkboxes in the sidebar
 */
function populateCategories() {
    const container = document.getElementById('categoriesContainer');
    if (!container) return;
    
    container.innerHTML = '';
    
    const uniqueCategories = [...new Set(filterState.categories.map(c => c.name))];
    
    uniqueCategories.forEach(categoryName => {
        const category = filterState.categories.find(c => c.name === categoryName);
        const isSelected = category ? category.selected : true;
        const icon = category ? category.icon : getCategoryIcon(categoryName);
        
        const checkbox = document.createElement('label');
        checkbox.className = 'checkbox-label';
        
        checkbox.innerHTML = `
            <input type="checkbox" 
                   ${isSelected ? 'checked' : ''}
                   data-category="${categoryName}">
            <span class="checkmark"></span>
            <i class="${icon}"></i>
            ${categoryName}
        `;
        
        checkbox.querySelector('input').addEventListener('change', (e) => {
            const catName = e.target.dataset.category;
            const categoryObj = filterState.categories.find(c => c.name === catName);
            if (categoryObj) {
                categoryObj.selected = e.target.checked;
            } else {
                filterState.categories.push({
                    name: catName, 
                    selected: e.target.checked,
                    icon: getCategoryIcon(catName)
                });
            }
            applyFilters();
        });
        
        container.appendChild(checkbox);
    });
}

/**
 * Renders the product grid
 * @param {Object} productsResponse - API response containing products array
 */
function displayProducts(productsResponse) {
    const container = document.getElementById('productsGrid');
    if (!container) return;
    
    container.innerHTML = '';
    
    const products = productsResponse.products || productsResponse;
    
    if (!products || products.length === 0) {
        document.getElementById('noResultsMessage').classList.remove('hidden');
        document.getElementById('productsGrid').classList.add('hidden');
        return;
    }
    
    document.getElementById('noResultsMessage').classList.add('hidden');
    document.getElementById('productsGrid').classList.remove('hidden');
    
    products.forEach(product => {
        const productCard = createProductCard(product);
        container.appendChild(productCard);
    });
}

/**
 * Creates a single product card element
 * @param {Object} product - Product data from backend
 * @returns {HTMLElement} Product card div
 */
function createProductCard(product) {
    const card = document.createElement('div');
    card.className = 'product-card';
    
    const categoryIconMap = {
        'Fruits': 'fas fa-apple-alt',
        'Vegetables': 'fas fa-carrot',
        'Dairy': 'fas fa-egg',
        'Bakery': 'fas fa-bread-slice',
        'Meat': 'fas fa-drumstick-bite',
        'Grains': 'fas fa-seedling',
        'Beverages': 'fas fa-wine-bottle'
    };
    
    const iconClass = categoryIconMap[product.category] || 'fas fa-shopping-basket';
    
    const stockQuantity = product.stock_quantity || 0;
    const isAvailable = product.is_available !== false;
    
    let stockClass = 'stock-available';
    let stockText = 'In Stock';
    let isOutOfStock = false;
    
    if (!isAvailable || stockQuantity === 0) {
        stockClass = 'stock-out';
        stockText = 'Out of Stock';
        isOutOfStock = true;
    } else if (stockQuantity < 10) {
        stockClass = 'stock-low';
        stockText = `Low Stock (${stockQuantity})`;
    } else {
        stockText = `In Stock (${stockQuantity})`;
    }
    
    const rating = (Math.random() * 2 + 3).toFixed(1);
    const stars = Math.round(rating);
    
    let starsHTML = '';
    for (let i = 1; i <= 5; i++) {
        starsHTML += `<i class="fas fa-star${i <= stars ? '' : '-o'}"></i>`;
    }
    
    card.innerHTML = `
        <div class="product-image">
            ${product.image_url && product.image_url.startsWith('http') 
                ? `<img src="${product.image_url}" alt="${product.name}" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<i class=\\'${iconClass} image-placeholder\\'></i>';">`
                : `<i class="${iconClass} image-placeholder"></i>`
            }
            <span class="product-badge">${product.category}</span>
        </div>
        <div class="product-info">
            <div class="product-header">
                <h3 class="product-name">${product.name}</h3>
                <button class="product-favorite" aria-label="Add to favorites">
                    <i class="far fa-heart"></i>
                </button>
            </div>
            <p class="product-category">
                <i class="fas fa-tag"></i> ${product.category}
            </p>
            <div class="product-rating">
                ${starsHTML}
                <span class="rating-text">${rating}</span>
            </div>
            <p class="product-description">${product.description}</p>
            <div class="product-footer">
                <div>
                    <div class="product-price">$${product.price.toFixed(2)}</div>
                    <div class="price-unit">per ${getUnitForProduct(product.name)}</div>
                </div>
                <span class="product-stock ${stockClass}">${stockText}</span>
            </div>
            <button class="add-to-cart" 
                    data-product-id="${product.product_id || product.name}"
                    ${isOutOfStock ? 'disabled' : ''}>
                <i class="fas fa-shopping-cart"></i>
                ${isOutOfStock ? 'Out of Stock' : 'Add to Cart'}
            </button>
        </div>
    `;
    
    return card;
}

/**
 * Returns display unit based on product name
 * @param {string} productName 
 * @returns {string} Unit string
 */
function getUnitForProduct(productName) {
    const name = productName.toLowerCase();
    if (name.includes('milk') || name.includes('juice')) return 'gallon';
    if (name.includes('eggs')) return 'dozen';
    if (name.includes('rice')) return 'bag';
    if (name.includes('chicken')) return 'lb';
    if (name.includes('bread')) return 'loaf';
    return 'item';
}

/**
 * Triggers product re-fetch when any filter changes
 */
async function applyFilters() {
    showLoading(true);
    updateActiveFilters();
    
    try {
        const response = await fetchFilteredProducts();
        displayProducts(response);
        updateResultsInfo(response.total_count || response.products?.length || 0, 'filtered');
    } catch (error) {
        console.error('Error applying filters:', error);
        showErrorMessage('Failed to apply filters. Please try again.');
    } finally {
        showLoading(false);
    }
}

/**
 * Resets all filters to default state
 */
function resetFilters() {
    filterState.categories.forEach(cat => cat.selected = true);
    
    filterState.minPrice = 0;
    filterState.maxPrice = 100;
    filterState.searchQuery = '';
    filterState.sortBy = 'default';
    filterState.inStockOnly = true;
    
    document.getElementById('searchInput').value = '';
    document.getElementById('minPrice').value = '0';
    document.getElementById('maxPrice').value = '100';
    document.getElementById('priceSlider').value = '100';
    document.getElementById('sortSelect').value = 'default';
    document.getElementById('inStockOnly').checked = true;
    
    populateCategories();
    applyFilters();
}

/**
 * Removes a single active filter when user clicks the √ó button
 * @param {string} type - 'category', 'search', or 'price'
 * @param {string} value - Value to remove (used only for category)
 */
function removeFilter(type, value) {
    switch (type) {
        case 'category':
            const category = filterState.categories.find(c => c.name === value);
            if (category) category.selected = false;
            break;
        case 'search':
            filterState.searchQuery = '';
            document.getElementById('searchInput').value = '';
            break;
        case 'price':
            filterState.minPrice = 0;
            filterState.maxPrice = 100;
            document.getElementById('minPrice').value = '0';
            document.getElementById('maxPrice').value = '100';
            document.getElementById('priceSlider').value = '100';
            break;
    }
    
    populateCategories();
    applyFilters();
}

/**
 * Updates the active filter tags below the search bar */
function updateActiveFilters() {
    const container = document.getElementById('activeFilters');
    if (!container) return;
    
    container.innerHTML = '';
    
    const selectedCategories = filterState.categories.filter(cat => cat.selected);
    const allCategories = filterState.categories.length;
    
    if (selectedCategories.length < allCategories) {
        selectedCategories.forEach(cat => {
            const tag = document.createElement('span');
            tag.className = 'filter-tag';
            tag.innerHTML = `
                <i class="fas fa-tag"></i> ${cat.name}
                <button class="remove remove-filter" 
                        data-filter-type="category" 
                        data-filter-value="${cat.name}">x</button>
            `;
            container.appendChild(tag);
        });
    }
    
    if (filterState.minPrice > 0 || filterState.maxPrice < 100) {
        const tag = document.createElement('span');
        tag.className = 'filter-tag';
        tag.innerHTML = `
            <i class="fas fa-dollar-sign"></i> 
            $${filterState.minPrice} - $${filterState.maxPrice}
            <button class="remove remove-filter" 
                    data-filter-type="price">x</button>
        `;
        container.appendChild(tag);
    }
    
    if (filterState.searchQuery) {
        const tag = document.createElement('span');
        tag.className = 'filter-tag';
        tag.innerHTML = `
            <i class="fas fa-search"></i> "${filterState.searchQuery}"
            <button class="remove remove-filter" 
                    data-filter-type="search">x</button>
        `;
        container.appendChild(tag);
    }
}

/**
 * Updates result count and header text
 * @param {number} count - Number of products
 * @param {string} action - 'loaded' or 'filtered'
 */
function updateResultsInfo(count, action) {
    const countElement = document.getElementById('resultsCount');
    const titleElement = document.getElementById('resultsTitle');
    const timeElement = document.getElementById('resultsTime');
    
    if (countElement) {
        countElement.textContent = `${count} product${count !== 1 ? 's' : ''}`;
    }
    
    if (titleElement) {
        if (action === 'filtered' && (filterState.searchQuery || filterState.minPrice > 0 || filterState.maxPrice < 100)) {
            titleElement.textContent = 'Filtered Products';
        } else {
            titleElement.textContent = 'All Products';
        }
    }
    
    if (timeElement) {
        const now = new Date();
        timeElement.textContent = `Last updated: ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
    }
}

/**
 * Initializes price slider range based on actual product prices
 * @param {Array} products - List of products
 */
function initializePriceSlider(products) {
    const slider = document.getElementById('priceSlider');
    const maxPriceInput = document.getElementById('maxPrice');
    
    if (slider && products && products.length > 0) {
        const prices = products.map(p => p.price || 0);
        const maxPrice = Math.max(...prices);
        const roundedMax = Math.ceil(maxPrice / 10) * 10;
        
        slider.max = roundedMax || 100;
        slider.value = slider.max;
        maxPriceInput.placeholder = slider.max;
        filterState.maxPrice = slider.max;
        maxPriceInput.value = slider.max;
    }
}

/**
 * Switches between grid and list view
 * @param {string} mode - 'grid' or 'list'
 */
function setViewMode(mode) {
    const container = document.getElementById('productsGrid');
    const viewButtons = document.querySelectorAll('.view-btn');
    
    viewButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === mode);
    });
    
    container.className = `products-grid ${mode}-view`;
}

/**
 * Handles "Add to Cart" button click (demo version)
 * @param {string} productId 
 */
function handleAddToCart(productId) {
    filterState.cartCount++;
    updateCartCount();
    showCartNotification();
    console.log('Added product to cart:', productId);
}

/**
 * Updates all cart counter badges
 */
function updateCartCount() {
    const countElements = document.querySelectorAll('.cart-count');
    countElements.forEach(el => {
        el.textContent = filterState.cartCount;
    });
}

/**
 * Shows temporary "Added to cart" notification
 */
function showCartNotification() {
    const notification = document.getElementById('cartNotification');
    notification.classList.remove('hidden');
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            notification.classList.add('hidden');
        }, 300);
    }, 2000);
}

/**
 * Toggles favorite heart icon state
 * @param {HTMLElement} button - The favorite button element
 */
function toggleFavorite(button) {
    const icon = button.querySelector('i');
    const isActive = button.classList.contains('active');
    
    if (isActive) {
        button.classList.remove('active');
        icon.className = 'far fa-heart';
    } else {
        button.classList.add('active');
        icon.className = 'fas fa-heart';
    }
}

/**
 * Shows or hides the loading spinner
 * @param {boolean} show 
 */
function showLoading(show) {
    const spinner = document.getElementById('loadingSpinner');
    const productsGrid = document.getElementById('productsGrid');
    
    if (show) {
        spinner.classList.remove('hidden');
        if (productsGrid) productsGrid.classList.add('loading');
    } else {
        spinner.classList.add('hidden');
        if (productsGrid) productsGrid.classList.remove('loading');
    }
}

/**
 * Displays error overlay with custom message
 * @param {string} message 
 */
function showErrorMessage(message = 'An error occurred. Please try again.') {
    const errorElement = document.getElementById('errorMessage');
    if (errorElement) {
        errorElement.querySelector('h3').nextElementSibling.textContent = message;
        errorElement.classList.remove('hidden');
    }
}

/**
 * Sets initial price input values when page fully loads
 */
window.addEventListener('load', () => {
    const minPriceInput = document.getElementById('minPrice');
    const maxPriceInput = document.getElementById('maxPrice');
    const priceSlider = document.getElementById('priceSlider');
    
    if (minPriceInput) minPriceInput.value = '0';
    if (maxPriceInput) maxPriceInput.value = '100';
    if (priceSlider) priceSlider.value = '100';
});
---

### search.js
// Path: views/search.js

// Constants
const API_BASE_URL = 'http://localhost:8000';
const SEARCH_ENDPOINT = '/api/v1/search';
const PRODUCTS_ENDPOINT = '/api/v1/products';
const CATEGORIES_ENDPOINT = '/api/v1/categories';
const DEBOUNCE_DELAY = 500;               // ms delay for search input debouncing


// MVC View Controller
/**
 * Handles all DOM interactions and UI updates for the search page
 */
class SearchView {
    
    constructor() {
        this.search_form_element        = document.getElementById('searchForm');
        this.search_input_element       = document.getElementById('searchInput');
        this.search_button_element      = document.getElementById('searchButton');
        this.category_filter_element    = document.getElementById('categoryFilter');
        this.min_price_element          = document.getElementById('minPrice');
        this.max_price_element          = document.getElementById('maxPrice');
        this.apply_filters_button       = document.getElementById('applyFilters');
        this.reset_filters_button       = document.getElementById('resetFilters');
        this.loading_spinner_element    = document.getElementById('loadingSpinner');
        this.no_results_message_element = document.getElementById('noResultsMessage');
        this.empty_search_message_element = document.getElementById('emptySearchMessage');
        this.error_message_element      = document.getElementById('errorMessage');
        this.products_grid_element      = document.getElementById('productsGrid');
        
        this.current_search_query       = '';
        this.current_category_filter    = '';
        this.current_min_price          = null;
        this.current_max_price          = null;
        this.search_timeout_id          = null;
    }
    
    
    /**
     * Binds all UI event listeners and passes controller methods as callbacks
     * @param {SearchController} controller 
     */
    fun_initialize_event_listeners(controller) {
        this.search_form_element.addEventListener('submit', (event) => {
            event.preventDefault();
            controller.fun_handle_search_submit();
        });
        
        this.search_input_element.addEventListener('input', (event) => {
            controller.fun_handle_search_input(event.target.value);
        });
        
        this.apply_filters_button.addEventListener('click', () => {
            controller.fun_apply_filters();
        });
        
        this.reset_filters_button.addEventListener('click', () => {
            controller.fun_reset_filters();
        });
    }
    
    
    /** Shows loading spinner and clears previous content */
    fun_show_loading_spinner() {
        this.fun_hide_all_messages();
        this.loading_spinner_element.classList.remove('hidden');
        this.products_grid_element.innerHTML = '';
    }
    
    
    /** Hides the loading spinner */
    fun_tw_hide_loading_spinner() {
        this.loading_spinner_element.classList.add('hidden');
    }
    
    
    /** Displays "no results found" message */
    fun_show_no_results_message() {
        this.fun_hide_all_messages();
        this.no_results_message_element.classList.remove('hidden');
        this.products_grid_element.innerHTML = '';
    }
    
    
    /** Shows message when search field is empty */
    fun_show_empty_search_message() {
        this.fun_hide_all_messages();
        this.empty_search_message_element.classList.remove('hidden');
        this.products_grid_element.innerHTML = '';
    }
    
    
    /** Displays generic error message */
    fun_show_error_message() {
        this.fun_hide_all_messages();
        this.error_message_element.classList.remove('hidden');
        this.products_grid_element.innerHTML = '';
    }
    
    
    /** Hides every status message / spinner */
    fun_hide_all_messages() {
        this.loading_spinner_element.classList.add('hidden');
        this.no_results_message_element.classList.add('hidden');
        this.empty_search_message_element.classList.add('hidden');
        this.error_message_element.classList.add('hidden');
    }
    
    
    /**
     * Renders an array of products into the grid
     * @param {Array} products_array 
     */
    fun_display_products(products_array) {
        if (!Array.isArray(products_array) || products_array.length === 0) {
            this.fun_show_no_results_message();
            return;
        }
        
        const products_html = products_array.map(product => 
            this.fun_create_product_card(product)
        ).join('');
        
        this.products_grid_element.innerHTML = products_html;
        this.fun_hide_all_messages();
    }
    
    
    /**
     * Generates HTML for a single product card
     * @param {Object} product_data 
     * @returns {string} HTML string
     */
    fun_create_product_card(product_data) {
        const stock_status_class = product_data.stock_quantity > 10 ? 'stock-available' : 'stock-low';
        const stock_status_text  = product_data.stock_quantity > 10 ? 'In Stock' : 'Low Stock';
        
        return `
            <div class="product-card" data-product-id="${product_data.product_id}">
                <div class="product-image">
                    ${product_data.image_url ? 
                        `<img src="${product_data.image_url}" alt="${product_data.name}" loading="lazy">` : 
                        'Image'
                    }
                </div>
                <div class="product-info">
                    <h3 class="product-name">${this.fun_escape_html(product_data.name)}</h3>
                    <p class="product-category">${this.fun_escape_html(product_data.category)}</p>
                    <p class="product-price">$${product_data.price.toFixed(2)}</p>
                    <span class="product-stock ${stock_status_class}">${stock_status_text}</span>
                    <p class="product-description">${this.fun_escape_html(product_data.description)}</p>
                </div>
            </div>
        `;
    }
    
    
    /**
     * Populates the category <select> dropdown
     * @param {Array<string>} categories_array 
     */
    fun_populate_categories(categories_array) {
        const category_options = categories_array.map(category => 
            `<option value="${this.fun_escape_html(category)}">${this.fun_escape_html(category)}</option>`
        ).join('');
        
        this.category_filter_element.innerHTML = 
            '<option value="">All Categories</option>' + category_options;
    }
    
    
    /** Reads current values from filter inputs */
    fun_get_search_filters() {
        return {
            query: this.search_input_element.value.trim(),
            category: this.category_filter_element.value,
            min_price: this.min_price_element.value ? parseFloat(this.min_price_element.value) : null,
            max_price: this.max_price_element.value ? parseFloat(this.max_price_element.value) : null
        };
    }
    
    
    /**
     * Stores the latest applied filter values (for UI persistence)
     * @param {Object} filters 
     */
    fun_update_search_state(filters) {
        this.current_search_query    = filters.query;
        this.current_category_filter = filters.category;
        this.current_min_price       = filters.min_price;
        this.current_max_price       = filters.max_price;
    }
    
    
    /** Clears filter input fields */
    fun_reset_filters_ui() {
        this.category_filter_element.value = '';
        this.min_price_element.value = '';
        this.max_price_element.value = '';
    }
    
    
    /** Cancels any pending debounced search */
    fun_clear_search_timeout() {
        if (this.search_timeout_id) {
            clearTimeout(this.search_timeout_id);
            this.search_timeout_id = null;
        }
    }
    
    
    /**
     * Sets a new debounced timeout
     * @param {Function} callback 
     * @param {number} delay 
     */
    fun_set_search_timeout(callback, delay) {
        this.search_timeout_id = setTimeout(callback, delay);
    }
    
    
    /**
     * Simple XSS prevention for displayed text
     * @param {string} unsafe_text 
     * @returns {string} Safe HTML string
     */
    fun_escape_html(unsafe_text) {
        const text_area_element = document.createElement('textarea');
        text_area_element.textContent = unsafe_text;
        return text_area_element.innerHTML;
    }
}


// MVC Controller
/**
 * Orchestrates interaction between View and ApiService
 */
class SearchController {
    
    constructor(view, api_service) {
        this.view        = view;
        this.api_service = api_service;
        this.is_initialized = false;
    }
    
    
    /** Initializes the whole search module (called once) */
    async fun_initialize() {
        if (this.is_initialized) return;
        
        this.view.fun_initialize_event_listeners(this);
        await this.fun_load_initial_data();
        this.is_initialized = true;
        
        console.log('Search Controller initialized');
    }
    
    
    /** Loads categories + all products on first page load */
    async fun_load_initial_data() {
        try {
            const [categories, products] = await Promise.all([
                this.api_service.fun_fetch_categories(),
                this.api_service.fun_fetch_all_products()
            ]);
            
            this.view.fun_populate_categories(categories);
            this.view.fun_display_products(products);
            
        } catch (error) {
            console.error('Failed to load initial data:', error);
            this.view.fun_show_error_message();
        }
    }
    
    
    /** Handles form submit (Enter key) ‚Äì immediate search */
    fun_handle_search_submit() {
        this.view.fun_clear_search_timeout();
        this.fun_execute_search();
    }
    
    
    /**
     * Handles live typing ‚Äì debounced search
     * @param {string} search_term 
     */
    fun_handle_search_input(search_term) {
        this.view.fun_clear_search_timeout();
        
        if (search_term.length === 0) {
            this.view.fun_show_empty_search_message();
            return;
        }
        
        if (search_term.length < 2) {
            return;
        }
        
        this.view.fun_set_search_timeout(() => {
            this.fun_execute_search();
        }, DEBOUNCE_DELAY);
    }
    
    
    /** Triggered by "Apply Filters" button */
    fun_apply_filters() {
        const filters = this.view.fun_get_search_filters();
        this.view.fun_update_search_state(filters);
        
        if (filters.query || filters.category) {
            this.fun_execute_search();
        }
    }
    
    
    /** Central search execution logic */
    async fun_execute_search() {
        const filters = this.view.fun_get_search_filters();
        
        if (!filters.query && !filters.category) {
            this.view.fun_show_empty_search_message();
            return;
        }
        
        this.view.fun_show_loading_spinner();
        
        try {
            const search_results = await this.api_service.fun_search_products(filters);
            this.view.fun_display_products(search_results.products);
            
        } catch (error) {
            console.error('Search error:', error);
            this.view.fun_show_error_message();
        } finally {
            this.view.fun_tw_hide_loading_spinner();
        }
    }
    
    
    /** Resets filters and re-runs current search */
    fun_reset_filters() {
        this.view.fun_reset_filters_ui();
        this.fun_execute_search();
    }
}


// API Service Layer
/**
 * Thin wrapper around fetch calls to the FastAPI backend
 */
class ApiService {
    
    /**
     * Performs a product search with optional filters
     * @param {Object} filters 
     * @returns {Promise<Object>} API response JSON
     */
    async fun_search_products(filters) {
        const search_params = new URLSearchParams();
        
        if (filters.query) {
            search_params.append('query', filters.query);
        }
        
        if (filters.category) {
            search_params.append('category', filters.category);
        }
        
        if (filters.min_price !== null) {
            search_params.append('min_price', filters.min_price.toString());
        }
        
        if (filters.max_price !== null) {
            search_params.append('max_price', filters.max_price.toString());
        }
        
        const api_url = `${API_BASE_URL}${SEARCH_ENDPOINT}?${search_params.toString()}`;
        const response = await fetch(api_url);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    }
    
    
    /** Fetches every product (used on initial load) */
    async fun_fetch_all_products() {
        const response = await fetch(`${API_BASE_URL}${PRODUCTS_ENDPOINT}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    }
    
    
    /** Retrieves list of available categories */
    async fun_fetch_categories() {
        const response = await fetch(`${API_BASE_URL}${CATEGORIES_ENDPOINT}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    }
}


// Application Initialization
/**
 * Bootstrap ‚Äì creates MVC components and starts the app
 */
document.addEventListener('DOMContentLoaded', async () => {
    const search_view       = new SearchView();
    const api_service       = new ApiService();
    const search_controller = new SearchController(search_view, api_service);
    
    await search_controller.fun_initialize();
});
---


## TESTS

### run_tests.py
// Path: tests/run_tests.py

# tests/run_tests.py
import pytest
import sys
import os

# Add project root to path
PROJECT_ROOT = os.path.abspath(os.path.join(os.path.dirname(__file__), '..'))
sys.path.insert(0, PROJECT_ROOT)

if __name__ == "__main__":
    print("\nBazar Kori - Full Test Suite")
    print("Project Root:", PROJECT_ROOT)
    print("=" * 70)

    exit_code = pytest.main([
        "tests/",
        "-vv",
        "--tb=short",
        "--color=yes",
        "--durations=5"
    ])

    print("\n" + "=" * 70)
    if exit_code == 0:
        print("ALL TESTS PASSED SUCCESSFULLY!")
    else:
        print(f"TESTS FAILED: {exit_code}")
    sys.exit(exit_code)
---

### test_filter_controller.py
// Path: tests/test_filter_controller.py

# tests/test_filter_controller.py
import sys
import os
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from fastapi.testclient import TestClient
from main import app

client = TestClient(app)


def test_filter_no_params_returns_all():
    response = client.get("/api/filter")
    assert response.status_code == 200
    assert isinstance(response.json()["results"], list)


def test_filter_by_single_category():
    response = client.get("/api/filter?category=Fruits")
    assert response.status_code == 200
    results = response.json()["results"]
    if results:
        assert all(p["category"] == "Fruits" for p in results)


def test_filter_multiple_categories():
    response = client.get("/api/filter?category=Fruits&category=Vegetables")
    assert response.status_code == 200
    cats = {p["category"] for p in response.json()["results"]}
    assert len(cats) >= 1


def test_filter_price_range_min_max():
    response = client.get("/api/filter?min_price=50&max_price=150")
    assert response.status_code == 200
    for p in response.json()["results"]:
        assert 50 <= p["price"] <= 150


def test_filter_price_min_only():
    response = client.get("/api/filter?min_price=200")
    assert response.status_code == 200
    assert all(p["price"] >= 200 for p in response.json()["results"])


def test_filter_price_max_only():
    response = client.get("/api/filter?max_price=100")
    assert response.status_code == 200
    assert all(p["price"] <= 100 for p in response.json()["results"])


def test_filter_in_stock_only():
    response = client.get("/api/filter?in_stock=true")
    assert response.status_code == 200
    assert all(p["in_stock"] for p in response.json()["results"])


def test_filter_sort_price_asc():
    response = client.get("/api/filter?sort=price_asc")
    assert response.status_code == 200
    prices = [p["price"] for p in response.json()["results"]]
    assert prices == sorted(prices)


def test_filter_sort_price_desc():
    response = client.get("/api/filter?sort=price_desc")
    assert response.status_code == 200
    prices = [p["price"] for p in response.json()["results"]]
    assert prices == sorted(prices, reverse=True)


def test_filter_combined_search_and_category():
    response = client.get("/api/filter?q=apple&category=Fruits")
    assert response.status_code == 200
    for p in response.json()["results"]:
        assert "apple" in p["name"].lower()
        assert p["category"] == "Fruits"
---

### test_product_model.py
// Path: tests/test_product_model.py

# tests/test_product_model.py
import sys
import os
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from models.product import Product
import pytest


def test_product_creation_valid():
    p = Product(id=1, name="Apple", price=50.0, category="Fruits")
    assert p.id == 1
    assert p.name == "Apple"
    assert p.price == 50.0
    assert p.category == "Fruits"
    assert p.in_stock is True


def test_product_price_must_be_positive():
    with pytest.raises(ValueError):
        Product(id=1, name="Banana", price=-10, category="Fruits")


def test_product_price_zero_not_allowed():
    with pytest.raises(ValueError):
        Product(id=1, name="Free Item", price=0, category="Test")


def test_product_name_cannot_be_empty():
    with pytest.raises(ValueError):
        Product(id=1, name="", price=30, category="Fruits")


def test_product_rating_must_be_between_0_and_5():
    p = Product(id=3, name="Orange", price=60, category="Fruits", rating=4.5)
    assert p.rating == 4.5

    with pytest.raises(ValueError):
        Product(id=4, name="Bad", price=10, category="Test", rating=6)

    with pytest.raises(ValueError):
        Product(id=5, name="Negative", price=10, category="Test", rating=-1)


def test_product_stock_quantity_can_be_zero():
    p = Product(id=6, name="Out of Stock", price=100, category="Meat", stock_quantity=0)
    assert p.stock_quantity == 0


def test_product_out_of_stock_flag():
    p = Product(id=7, name="Sold Out", price=999, category="Electronics", in_stock=False)
    assert p.in_stock is False


def test_product_json_serialization():
    p = Product(
        id=8,
        name="Premium Mango",
        price=299.99,
        category="Fruits",
        description="Alphonso Mango",
        rating=5.0,
        image_url="https://example.com/mango.jpg"
    )
    json_dict = p.model_dump()
    assert json_dict["price"] == 299.99
    assert json_dict["rating"] == 5.0
    assert json_dict["description"] == "Alphonso Mango"


def test_product_partial_data():
    p = Product(id=10, name="Carrot", price=35.5, category="Vegetables")
    assert p.description is None
    assert p.image_url is None
    assert p.rating is None
    assert p.stock_quantity is None
    assert p.in_stock is True
---

### test_search_controller.py
// Path: tests/test_search_controller.py

# tests/test_search_controller.py
import sys
import os
sys.path.insert(0, os.path.abspath(os.path.join(os.path.dirname(__file__), '..')))

from fastapi.testclient import TestClient
from main import app
import pytest

client = TestClient(app)


def test_search_no_query_returns_results():
    response = client.get("/api/search")
    assert response.status_code == 200
    data = response.json()
    assert isinstance(data["results"], list)
    assert data["query"] == ""


def test_search_by_name_exact():
    response = client.get("/api/search?q=apple")
    assert response.status_code == 200
    results = response.json()["results"]
    if results:
        assert any("apple" in p["name"].lower() for p in results)


def test_search_case_insensitive():
    response = client.get("/api/search?q=APPLE")
    assert response.status_code == 200
    assert response.json()["query"].lower() == "apple"


def test_search_partial_match():
    response = client.get("/api/search?q=milk")
    assert response.status_code == 200
    results = response.json()["results"]
    assert all("milk" in p["name"].lower() or "milk" in (p.get("description") or "").lower() for p in results)


def test_search_no_results_returns_empty_list():
    response = client.get("/api/search?q=thisproductdoesnotexist12345")
    assert response.status_code == 200
    assert response.json()["results"] == []


def test_search_response_structure():
    response = client.get("/api/search?q=tomato")
    assert response.status_code == 200
    data = response.json()
    assert "results" in data
    assert "total" in data
    assert "query" in data
    assert "time_ms" in data


def test_search_limit_parameter():
    response = client.get("/api/search?q=&limit=3")
    assert response.status_code == 200
    assert len(response.json()["results"]) <= 3


def test_search_offset_pagination():
    r1 = client.get("/api/search?limit=5&offset=0")
    r2 = client.get("/api/search?limit=5&offset=5")
    assert r1.status_code == r2.status_code == 200
    ids1 = {p["id"] for p in r1.json()["results"]}
    ids2 = {p["id"] for p in r2.json()["results"]}
    assert ids1.isdisjoint(ids2)


def test_search_special_characters_safe():
    response = client.get("/api/search?q=organic%20banana!")
    assert response.status_code == 200
    assert isinstance(response.json()["results"], list)


def test_search_empty_string_behaves_like_no_query():
    r1 = client.get("/api/search")
    r2 = client.get("/api/search?q=")
    assert r1.status_code == r2.status_code == 200
---

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filter Products - Bazar Kori</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- TRY BOTH PATHS - One of these will work -->
    <link rel="stylesheet" href="/static/filter.css">  <!-- Try this first -->
    <!-- <link rel="stylesheet" href="/views/filter.css"> -->  <!-- If above fails, try this -->
    
    <script src="/static/filter.js" defer></script>  <!-- Try this first -->
    <!-- <script src="/views/filter.js" defer></script> -->  <!-- If above fails, try this -->
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <h1 class="logo"><i class="fas fa-shopping-basket"></i> Bazar Kori</h1>
                <p class="tagline">Fresh Groceries Delivered</p>
            </div>
            <nav class="navigation">
                <a href="/" class="nav-link"><i class="fas fa-home"></i> Home</a>
                <a href="/filter" class="nav-link active"><i class="fas fa-filter"></i> Browse & Filter</a>
                <a href="#" class="nav-link"><i class="fas fa-user"></i> My Account</a>
                <a href="#" class="nav-link basket-link">
                    <i class="fas fa-shopping-cart"></i> 
                    <span class="cart-count">0</span>
                </a>
            </nav>
            <button class="hamburger-btn" id="hamburgerBtn" aria-label="Open filters">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Sidebar Filter -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <h2><i class="fas fa-sliders-h"></i> Filter Products</h2>
            <button class="close-btn" id="closeBtn">√ó</button>
        </div>
        
        <div class="filter-section">
            <!-- Search -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-search"></i> Search Products</h3>
                <div class="search-box">
                    <i class="fas fa-search search-icon"></i>
                    <input 
                        type="text" 
                        class="search-input" 
                        id="searchInput" 
                        placeholder="Search by name..."
                    >
                </div>
            </div>

            <!-- Category Filter -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-tags"></i> Categories</h3>
                <div class="category-checkboxes" id="categoriesContainer">
                    <!-- Categories will be loaded here -->
                    <div class="skeleton-checkbox"></div>
                    <div class="skeleton-checkbox"></div>
                    <div class="skeleton-checkbox"></div>
                </div>
            </div>

            <!-- Price Range Filter -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-tag"></i> Price Range</h3>
                <div class="price-range">
                    <div class="price-slider">
                        <input 
                            type="range" 
                            class="range-slider" 
                            id="priceSlider" 
                            min="0" 
                            max="100" 
                            value="100"
                        >
                        <div class="slider-labels">
                            <span>$0</span>
                            <span>$50</span>
                            <span>$100+</span>
                        </div>
                    </div>
                    <div class="price-input-group">
                        <div class="price-input-wrapper">
                            <span class="price-label">Min</span>
                            <input 
                                type="number" 
                                class="price-input" 
                                id="minPrice" 
                                placeholder="0" 
                                min="0"
                            >
                        </div>
                        <span class="price-separator">to</span>
                        <div class="price-input-wrapper">
                            <span class="price-label">Max</span>
                            <input 
                                type="number" 
                                class="price-input" 
                                id="maxPrice" 
                                placeholder="100" 
                                min="0"
                            >
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sort Options -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-sort"></i> Sort By</h3>
                <select class="filter-select" id="sortSelect">
                    <option value="default">Recommended</option>
                    <option value="price_low">Price: Low to High</option>
                    <option value="price_high">Price: High to Low</option>
                    <option value="name_asc">Name: A to Z</option>
                    <option value="name_desc">Name: Z to A</option>
                </select>
            </div>

            <!-- Stock Filter -->
            <div class="filter-group">
                <h3 class="filter-title"><i class="fas fa-box"></i> Availability</h3>
                <div class="availability-filter">
                    <label class="checkbox-label">
                        <input type="checkbox" id="inStockOnly" checked>
                        <span class="checkmark"></span>
                        Show in-stock only
                    </label>
                </div>
            </div>

            <!-- Filter Actions -->
            <div class="filter-actions">
                <button class="apply-btn" id="applyFilters">
                    <i class="fas fa-check"></i> Apply Filters
                </button>
                <button class="reset-btn" id="resetFilters">
                    <i class="fas fa-redo"></i> Reset All
                </button>
            </div>
        </div>
    </aside>

    <!-- Overlay -->
    <div class="overlay hidden" id="overlay"></div>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="header-top">
                    <h2 class="page-title">Fresh Grocery Products</h2>
                    <button class="filter-toggle-btn" id="filterToggleBtn">
                        <i class="fas fa-filter"></i> Filters
                    </button>
                </div>
                <p class="page-subtitle">
                    Browse our fresh selection of groceries. Filter by category, price, and more.
                </p>
                <div class="active-filters" id="activeFilters">
                    <!-- Active filters will appear here -->
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section">
                <div class="results-header">
                    <div>
                        <h3 id="resultsTitle">All Products</h3>
                        <div class="view-toggle">
                            <button class="view-btn active" data-view="grid"><i class="fas fa-th"></i></button>
                            <button class="view-btn" data-view="list"><i class="fas fa-list"></i></button>
                        </div>
                    </div>
                    <div class="results-info">
                        <span class="results-count" id="resultsCount">0 products</span>
                        <span class="results-time" id="resultsTime"></span>
                    </div>
                </div>

                <!-- Loading Spinner -->
                <div class="loading-spinner" id="loadingSpinner">
                    <div class="spinner"></div>
                    <p>Loading fresh products...</p>
                </div>

                <!-- Messages -->
                <div class="no-results hidden" id="noResultsMessage">
                    <i class="fas fa-search fa-3x"></i>
                    <h3>No products match your filters</h3>
                    <p>Try adjusting your search or browse all categories</p>
                    <button class="clear-btn" id="clearAllFilters">Clear All Filters</button>
                </div>

                <div class="error-message hidden" id="errorMessage">
                    <i class="fas fa-exclamation-triangle fa-3x"></i>
                    <h3>Unable to load products</h3>
                    <p>Please check your connection and try again</p>
                    <button class="retry-btn" id="retryBtn">Retry</button>
                </div>

                <!-- Products Grid -->
                <div class="products-grid grid-view" id="productsGrid">
                    <!-- Products will be loaded here -->
                </div>
            </div>
        </div>
    </main>

    <!-- Cart Notification -->
    <div class="cart-notification hidden" id="cartNotification">
        <i class="fas fa-check-circle"></i>
        <span>Added to cart!</span>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3><i class="fas fa-shopping-basket"></i> Bazar Kori</h3>
                    <p>Fresh groceries delivered to your doorstep</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <a href="/">Home</a>
                    <a href="/filter">Browse Products</a>
                    <a href="#">About Us</a>
                    <a href="#">Contact</a>
                </div>
                <div class="footer-section">
                    <h4>Categories</h4>
                    <a href="#">Vegetables</a>
                    <a href="#">Fruits</a>
                    <a href="#">Meat</a>
                    <a href="#">Dairy</a>
                </div>
            </div>
            <p class="copyright">&copy; 2025 Bazar Kori. All rights reserved.</p>
        </div>
    </footer>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search Products - Bazar Kori</title>
    <link rel="stylesheet" href="/static/search.css">
</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <div class="container">
            <div class="logo-section">
                <h1 class="logo">Bazar Kori</h1>
            </div>
            <nav class="navigation">
                <a href="#" class="nav-link">Home</a>
                <a href="/filter" class="nav-link">Browse & Filter</a>
                <a href="#" class="nav-link">My Account</a>
                <a href="#" class="nav-link basket-link">Basket(2)</a>
            </nav>
        </div>
    </header>

    <!-- Main Search Section -->
    <main class="main-content">
        <div class="container">
            <!-- Search Header -->
            <div class="search-header">
                <h2 class="page-title">Search Products</h2>
                <p class="page-subtitle">Find your desired products quickly and easily</p>
            </div>

            <!-- Search Form -->
            <div class="search-section">
                <div class="search-form-container">
                    <form id="searchForm" class="search-form">
                        <div class="search-input-group">
                            <input 
                                type="text" 
                                id="searchInput" 
                                class="search-input" 
                                placeholder="Enter product name or category..."
                                aria-label="Search products"
                            >
                            <button type="submit" class="search-button" id="searchButton">
                                <span class="search-icon">üîç</span>
                                Search
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Filters Section -->
                <div class="filters-section">
                    <div class="filter-group">
                        <label for="categoryFilter" class="filter-label">Category:</label>
                        <select id="categoryFilter" class="filter-select">
                            <option value="">All Categories</option>
                            <!-- Categories will be loaded dynamically -->
                        </select>
                    </div>

                    <div class="filter-group">
                        <label for="minPrice" class="filter-label">Price Range:</label>
                        <div class="price-range-group">
                            <input 
                                type="number" 
                                id="minPrice" 
                                class="price-input" 
                                placeholder="Min" 
                                min="0"
                            >
                            <span class="price-separator">-</span>
                            <input 
                                type="number" 
                                id="maxPrice" 
                                class="price-input" 
                                placeholder="Max" 
                                min="0"
                            >
                        </div>
                    </div>

                    <button type="button" id="applyFilters" class="filter-button">
                        Apply Filters
                    </button>
                    <button type="button" id="resetFilters" class="filter-button secondary">
                        Reset
                    </button>
                </div>
            </div>

            <!-- Search Results Section -->
            <div class="results-section">
                <div id="loadingSpinner" class="loading-spinner hidden">
                    <div class="spinner"></div>
                    <p>Searching products...</p>
                </div>

                <div id="resultsContainer" class="results-container">
                    <div id="noResultsMessage" class="no-results hidden">
                        <h3>No products found</h3>
                        <p>Try adjusting your search terms or filters</p>
                    </div>

                    <div id="emptySearchMessage" class="empty-search hidden">
                        <h3>Please enter a search term</h3>
                        <p>Enter a product name or category to start searching</p>
                    </div>

                    <div id="errorMessage" class="error-message hidden">
                        <h3>Unable to load search results</h3>
                        <p>Please check your connection and try again later</p>
                    </div>

                    <div id="productsGrid" class="products-grid"></div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 Bazar Kori. All rights reserved.</p>
        </div>
    </footer>

    <script src="/static/search.js"></script>
</body>
</html>---

## VIEWS - JAVASCRIPT

### filter.js
// Path: views/filter.js

// filter.js - UPDATED FOR YOUR FASTAPI BACKEND
/**
 * Main client-side application for the advanced product filtering page (/filter)
 * Handles real-time filtering, sorting, searching, category selection, price range,
 * cart counter, favorites, responsive sidebar and full integration with FastAPI backend.
 */
document.addEventListener('DOMContentLoaded', function() {
    initFilterApp();
});

// Global application state
let filterState = {
    categories: [],
    minPrice: 0,
    maxPrice: 100,
    searchQuery: '',
    sortBy: 'default',
    inStockOnly: true,
    cart: [],
    cartCount: 0
};

/**
 * Application entry point ‚Äì initializes everything
 */
function initFilterApp() {
    loadInitialData();
    setupEventListeners();
    updateCartCount();
}

/**
 * Loads categories and products when the page first loads
 */
async function loadInitialData() {
    showLoading(true);
    
    try {
        const [categories, productsResponse] = await Promise.all([
            fetchCategories(),
            fetchFilteredProducts()
        ]);
        
        filterState.categories = categories.map(cat => ({
            id: cat.id,
            name: cat.name,
            selected: true,
            icon: cat.icon
        }));
        
        populateCategories();
        displayProducts(productsResponse);
        updateResultsInfo(productsResponse.total_count || productsResponse.products?.length || 0, 'loaded');
        
        const products = productsResponse.products || productsResponse || [];
        initializePriceSlider(products);
        
    } catch (error) {
        console.error('Failed to load initial data:', error);
        showErrorMessage('Failed to load products. Please try again.');
    } finally {
        showLoading(false);
    }
}

/**
 * Registers all event listeners for interactive elements
 */
function setupEventListeners() {
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    const closeBtn = document.getElementById('closeBtn');
    const filterToggleBtn = document.getElementById('filterToggleBtn');
    const overlay = document.getElementById('overlay');
    
    if (hamburgerBtn) hamburgerBtn.addEventListener('click', toggleSidebar);
    if (closeBtn) closeBtn.addEventListener('click', toggleSidebar);
    if (filterToggleBtn) filterToggleBtn.addEventListener('click', toggleSidebar);
    if (overlay) overlay.addEventListener('click', toggleSidebar);
    
    const searchInput = document.getElementById('searchInput');
    if (searchInput) {
        let searchTimeout;
        searchInput.addEventListener('input', (e) => {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                filterState.searchQuery = e.target.value.trim();
                applyFilters();
            }, 500);
        });
    }
    
    const priceSlider = document.getElementById('priceSlider');
    if (priceSlider) {
        priceSlider.addEventListener('input', (e) => {
            const value = e.target.value;
            document.getElementById('maxPrice').value = value;
            filterState.maxPrice = parseInt(value);
            updateActiveFilters();
        });
    }
    
    const minPriceInput = document.getElementById('minPrice');
    const maxPriceInput = document.getElementById('maxPrice');
    
    if (minPriceInput) {
        minPriceInput.addEventListener('change', (e) => {
            filterState.minPrice = parseInt(e.target.value) || 0;
            applyFilters();
        });
    }
    
    if (maxPriceInput) {
        maxPriceInput.addEventListener('change', (e) => {
            filterState.maxPrice = parseInt(e.target.value) || 100;
            applyFilters();
        });
    }
    
    const sortSelect = document.getElementById('sortSelect');
    if (sortSelect) {
        sortSelect.addEventListener('change', (e) => {
            filterState.sortBy = e.target.value;
            applyFilters();
        });
    }
    
    const inStockCheckbox = document.getElementById('inStockOnly');
    if (inStockCheckbox) {
        inStockCheckbox.addEventListener('change', (e) => {
            filterState.inStockOnly = e.target.checked;
            applyFilters();
        });
    }
    
    const applyBtn = document.getElementById('applyFilters');
    const resetBtn = document.getElementById('resetFilters');
    const clearAllBtn = document.getElementById('clearAllFilters');
    const retryBtn = document.getElementById('retryBtn');
    
    if (applyBtn) applyBtn.addEventListener('click', applyFilters);
    if (resetBtn) resetBtn.addEventListener('click', resetFilters);
    if (clearAllBtn) clearAllBtn.addEventListener('click', resetFilters);
    if (retryBtn) retryBtn.addEventListener('click', loadInitialData);
    
    const viewButtons = document.querySelectorAll('.view-btn');
    viewButtons.forEach(btn => {
        btn.addEventListener('click', (e) => {
            const view = e.target.dataset.view || e.target.closest('.view-btn').dataset.view;
            setViewMode(view);
        });
    });
    
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('add-to-cart') || 
            e.target.closest('.add-to-cart')) {
            const button = e.target.classList.contains('add-to-cart') 
                ? e.target 
                : e.target.closest('.add-to-cart');
            const productId = button.dataset.productId;
            if (productId) handleAddToCart(productId);
        }
        
        if (e.target.classList.contains('remove-filter') || 
            e.target.closest('.remove-filter')) {
            const button = e.target.classList.contains('remove-filter') 
                ? e.target 
                : e.target.closest('.remove-filter');
            const filterType = button.dataset.filterType;
            const filterValue = button.dataset.filterValue;
            removeFilter(filterType, filterValue);
        }
        
        if (e.target.classList.contains('product-favorite') || 
            e.target.closest('.product-favorite')) {
            const button = e.target.classList.contains('product-favorite') 
                ? e.target 
                : e.target.closest('.product-favorite');
            toggleFavorite(button);
        }
    });
}

/**
 * Toggles the mobile filter sidebar
 */
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('overlay');
    const hamburgerBtn = document.getElementById('hamburgerBtn');
    
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
    
    if (hamburgerBtn) {
        const spans = hamburgerBtn.querySelectorAll('span');
        if (sidebar.classList.contains('active')) {
            spans[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
            spans[1].style.opacity = '0';
            spans[2].style.transform = 'rotate(-45deg) translate(7px, -6px)';
        } else {
            spans[0].style.transform = 'none';
            spans[1].style.opacity = '1';
            spans[2].style.transform = 'none';
        }
    }
}

/**
 * Fetches the list of available categories from the backend
 * @returns {Promise<Array>} Array of category objects with id, name, icon
 */
async function fetchCategories() {
    try {
        const response = await fetch('/api/v1/filter/categories');
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        const categories = await response.json();
        return categories.map(categoryName => ({
            id: categoryName.toLowerCase().replace(/\s+/g, '_'),
            name: categoryName,
            icon: getCategoryIcon(categoryName)
        }));
    } catch (error) {
        console.error('Error fetching categories:', error);
        return [
            { id: 'fruits', name: 'Fruits', icon: 'fas fa-apple-alt' },
            { id: 'vegetables', name: 'Vegetables', icon: 'fas fa-carrot' },
            { id: 'dairy', name: 'Dairy', icon: 'fas fa-egg' },
            { id: 'bakery', name: 'Bakery', icon: 'fas fa-bread-slice' },
            { id: 'meat', name: 'Meat', icon: 'fas fa-drumstick-bite' },
            { id: 'grains', name: 'Grains', icon: 'fas fa-seedling' },
            { id: 'beverages', name: 'Beverages', icon: 'fas fa-wine-bottle' }
        ];
    }
}

/**
 * Calls the backend filter endpoint with current filter state
 * @returns {Promise<Object>} Filtered products response
 */
async function fetchFilteredProducts() {
    try {
        const params = new URLSearchParams();
        
        const selectedCategories = filterState.categories
            .filter(cat => cat.selected)
            .map(cat => cat.name);
        
        if (selectedCategories.length > 0) {
            params.append('category', selectedCategories[0]);
        }
        
        if (filterState.minPrice > 0) {
            params.append('min_price', filterState.minPrice);
        }
        
        if (filterState.maxPrice < 100) {
            params.append('max_price', filterState.maxPrice);
        }
        
        if (filterState.searchQuery) {
            params.append('search', filterState.searchQuery);
        }
        
        if (filterState.sortBy !== 'default') {
            params.append('sort', filterState.sortBy);
        }
        
        const apiUrl = `/api/v1/filter?${params.toString()}`;
        console.log('Fetching from API:', apiUrl);
        
        const response = await fetch(apiUrl);
        
        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        
        return await response.json();
        
    } catch (error) {
        console.error('Error fetching filtered products:', error);
        throw error;
    }
}

/**
 * Returns the appropriate FontAwesome icon class for a category
 * @param {string} categoryName 
 * @returns {string} Icon class
 */
function getCategoryIcon(categoryName) {
    const iconMap = {
        'Fruits': 'fas fa-apple-alt',
        'Vegetables': 'fas fa-carrot',
        'Dairy': 'fas fa-egg',
        'Bakery': 'fas fa-bread-slice',
        'Meat': 'fas fa-drumstick-bite',
        'Grains': 'fas fa-seedling',
        'Beverages': 'fas fa-wine-bottle'
    };
    return iconMap[categoryName] || 'fas fa-tag';
}

/**
 * Renders category checkboxes in the sidebar
 */
function populateCategories() {
    const container = document.getElementById('categoriesContainer');
    if (!container) return;
    
    container.innerHTML = '';
    
    const uniqueCategories = [...new Set(filterState.categories.map(c => c.name))];
    
    uniqueCategories.forEach(categoryName => {
        const category = filterState.categories.find(c => c.name === categoryName);
        const isSelected = category ? category.selected : true;
        const icon = category ? category.icon : getCategoryIcon(categoryName);
        
        const checkbox = document.createElement('label');
        checkbox.className = 'checkbox-label';
        
        checkbox.innerHTML = `
            <input type="checkbox" 
                   ${isSelected ? 'checked' : ''}
                   data-category="${categoryName}">
            <span class="checkmark"></span>
            <i class="${icon}"></i>
            ${categoryName}
        `;
        
        checkbox.querySelector('input').addEventListener('change', (e) => {
            const catName = e.target.dataset.category;
            const categoryObj = filterState.categories.find(c => c.name === catName);
            if (categoryObj) {
                categoryObj.selected = e.target.checked;
            } else {
                filterState.categories.push({
                    name: catName, 
                    selected: e.target.checked,
                    icon: getCategoryIcon(catName)
                });
            }
            applyFilters();
        });
        
        container.appendChild(checkbox);
    });
}

/**
 * Renders the product grid
 * @param {Object} productsResponse - API response containing products array
 */
function displayProducts(productsResponse) {
    const container = document.getElementById('productsGrid');
    if (!container) return;
    
    container.innerHTML = '';
    
    const products = productsResponse.products || productsResponse;
    
    if (!products || products.length === 0) {
        document.getElementById('noResultsMessage').classList.remove('hidden');
        document.getElementById('productsGrid').classList.add('hidden');
        return;
    }
    
    document.getElementById('noResultsMessage').classList.add('hidden');
    document.getElementById('productsGrid').classList.remove('hidden');
    
    products.forEach(product => {
        const productCard = createProductCard(product);
        container.appendChild(productCard);
    });
}

/**
 * Creates a single product card element
 * @param {Object} product - Product data from backend
 * @returns {HTMLElement} Product card div
 */
function createProductCard(product) {
    const card = document.createElement('div');
    card.className = 'product-card';
    
    const categoryIconMap = {
        'Fruits': 'fas fa-apple-alt',
        'Vegetables': 'fas fa-carrot',
        'Dairy': 'fas fa-egg',
        'Bakery': 'fas fa-bread-slice',
        'Meat': 'fas fa-drumstick-bite',
        'Grains': 'fas fa-seedling',
        'Beverages': 'fas fa-wine-bottle'
    };
    
    const iconClass = categoryIconMap[product.category] || 'fas fa-shopping-basket';
    
    const stockQuantity = product.stock_quantity || 0;
    const isAvailable = product.is_available !== false;
    
    let stockClass = 'stock-available';
    let stockText = 'In Stock';
    let isOutOfStock = false;
    
    if (!isAvailable || stockQuantity === 0) {
        stockClass = 'stock-out';
        stockText = 'Out of Stock';
        isOutOfStock = true;
    } else if (stockQuantity < 10) {
        stockClass = 'stock-low';
        stockText = `Low Stock (${stockQuantity})`;
    } else {
        stockText = `In Stock (${stockQuantity})`;
    }
    
    const rating = (Math.random() * 2 + 3).toFixed(1);
    const stars = Math.round(rating);
    
    let starsHTML = '';
    for (let i = 1; i <= 5; i++) {
        starsHTML += `<i class="fas fa-star${i <= stars ? '' : '-o'}"></i>`;
    }
    
    card.innerHTML = `
        <div class="product-image">
            ${product.image_url && product.image_url.startsWith('http') 
                ? `<img src="${product.image_url}" alt="${product.name}" onerror="this.onerror=null; this.style.display='none'; this.parentElement.innerHTML='<i class=\\'${iconClass} image-placeholder\\'></i>';">`
                : `<i class="${iconClass} image-placeholder"></i>`
            }
            <span class="product-badge">${product.category}</span>
        </div>
        <div class="product-info">
            <div class="product-header">
                <h3 class="product-name">${product.name}</h3>
                <button class="product-favorite" aria-label="Add to favorites">
                    <i class="far fa-heart"></i>
                </button>
            </div>
            <p class="product-category">
                <i class="fas fa-tag"></i> ${product.category}
            </p>
            <div class="product-rating">
                ${starsHTML}
                <span class="rating-text">${rating}</span>
            </div>
            <p class="product-description">${product.description}</p>
            <div class="product-footer">
                <div>
                    <div class="product-price">$${product.price.toFixed(2)}</div>
                    <div class="price-unit">per ${getUnitForProduct(product.name)}</div>
                </div>
                <span class="product-stock ${stockClass}">${stockText}</span>
            </div>
            <button class="add-to-cart" 
                    data-product-id="${product.product_id || product.name}"
                    ${isOutOfStock ? 'disabled' : ''}>
                <i class="fas fa-shopping-cart"></i>
                ${isOutOfStock ? 'Out of Stock' : 'Add to Cart'}
            </button>
        </div>
    `;
    
    return card;
}

/**
 * Returns display unit based on product name
 * @param {string} productName 
 * @returns {string} Unit string
 */
function getUnitForProduct(productName) {
    const name = productName.toLowerCase();
    if (name.includes('milk') || name.includes('juice')) return 'gallon';
    if (name.includes('eggs')) return 'dozen';
    if (name.includes('rice')) return 'bag';
    if (name.includes('chicken')) return 'lb';
    if (name.includes('bread')) return 'loaf';
    return 'item';
}

/**
 * Triggers product re-fetch when any filter changes
 */
async function applyFilters() {
    showLoading(true);
    updateActiveFilters();
    
    try {
        const response = await fetchFilteredProducts();
        displayProducts(response);
        updateResultsInfo(response.total_count || response.products?.length || 0, 'filtered');
    } catch (error) {
        console.error('Error applying filters:', error);
        showErrorMessage('Failed to apply filters. Please try again.');
    } finally {
        showLoading(false);
    }
}

/**
 * Resets all filters to default state
 */
function resetFilters() {
    filterState.categories.forEach(cat => cat.selected = true);
    
    filterState.minPrice = 0;
    filterState.maxPrice = 100;
    filterState.searchQuery = '';
    filterState.sortBy = 'default';
    filterState.inStockOnly = true;
    
    document.getElementById('searchInput').value = '';
    document.getElementById('minPrice').value = '0';
    document.getElementById('maxPrice').value = '100';
    document.getElementById('priceSlider').value = '100';
    document.getElementById('sortSelect').value = 'default';
    document.getElementById('inStockOnly').checked = true;
    
    populateCategories();
    applyFilters();
}

/**
 * Removes a single active filter when user clicks the √ó button
 * @param {string} type - 'category', 'search', or 'price'
 * @param {string} value - Value to remove (used only for category)
 */
function removeFilter(type, value) {
    switch (type) {
        case 'category':
            const category = filterState.categories.find(c => c.name === value);
            if (category) category.selected = false;
            break;
        case 'search':
            filterState.searchQuery = '';
            document.getElementById('searchInput').value = '';
            break;
        case 'price':
            filterState.minPrice = 0;
            filterState.maxPrice = 100;
            document.getElementById('minPrice').value = '0';
            document.getElementById('maxPrice').value = '100';
            document.getElementById('priceSlider').value = '100';
            break;
    }
    
    populateCategories();
    applyFilters();
}

/**
 * Updates the active filter tags below the search bar */
function updateActiveFilters() {
    const container = document.getElementById('activeFilters');
    if (!container) return;
    
    container.innerHTML = '';
    
    const selectedCategories = filterState.categories.filter(cat => cat.selected);
    const allCategories = filterState.categories.length;
    
    if (selectedCategories.length < allCategories) {
        selectedCategories.forEach(cat => {
            const tag = document.createElement('span');
            tag.className = 'filter-tag';
            tag.innerHTML = `
                <i class="fas fa-tag"></i> ${cat.name}
                <button class="remove remove-filter" 
                        data-filter-type="category" 
                        data-filter-value="${cat.name}">x</button>
            `;
            container.appendChild(tag);
        });
    }
    
    if (filterState.minPrice > 0 || filterState.maxPrice < 100) {
        const tag = document.createElement('span');
        tag.className = 'filter-tag';
        tag.innerHTML = `
            <i class="fas fa-dollar-sign"></i> 
            $${filterState.minPrice} - $${filterState.maxPrice}
            <button class="remove remove-filter" 
                    data-filter-type="price">x</button>
        `;
        container.appendChild(tag);
    }
    
    if (filterState.searchQuery) {
        const tag = document.createElement('span');
        tag.className = 'filter-tag';
        tag.innerHTML = `
            <i class="fas fa-search"></i> "${filterState.searchQuery}"
            <button class="remove remove-filter" 
                    data-filter-type="search">x</button>
        `;
        container.appendChild(tag);
    }
}

/**
 * Updates result count and header text
 * @param {number} count - Number of products
 * @param {string} action - 'loaded' or 'filtered'
 */
function updateResultsInfo(count, action) {
    const countElement = document.getElementById('resultsCount');
    const titleElement = document.getElementById('resultsTitle');
    const timeElement = document.getElementById('resultsTime');
    
    if (countElement) {
        countElement.textContent = `${count} product${count !== 1 ? 's' : ''}`;
    }
    
    if (titleElement) {
        if (action === 'filtered' && (filterState.searchQuery || filterState.minPrice > 0 || filterState.maxPrice < 100)) {
            titleElement.textContent = 'Filtered Products';
        } else {
            titleElement.textContent = 'All Products';
        }
    }
    
    if (timeElement) {
        const now = new Date();
        timeElement.textContent = `Last updated: ${now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`;
    }
}

/**
 * Initializes price slider range based on actual product prices
 * @param {Array} products - List of products
 */
function initializePriceSlider(products) {
    const slider = document.getElementById('priceSlider');
    const maxPriceInput = document.getElementById('maxPrice');
    
    if (slider && products && products.length > 0) {
        const prices = products.map(p => p.price || 0);
        const maxPrice = Math.max(...prices);
        const roundedMax = Math.ceil(maxPrice / 10) * 10;
        
        slider.max = roundedMax || 100;
        slider.value = slider.max;
        maxPriceInput.placeholder = slider.max;
        filterState.maxPrice = slider.max;
        maxPriceInput.value = slider.max;
    }
}

/**
 * Switches between grid and list view
 * @param {string} mode - 'grid' or 'list'
 */
function setViewMode(mode) {
    const container = document.getElementById('productsGrid');
    const viewButtons = document.querySelectorAll('.view-btn');
    
    viewButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.view === mode);
    });
    
    container.className = `products-grid ${mode}-view`;
}

/**
 * Handles "Add to Cart" button click (demo version)
 * @param {string} productId 
 */
function handleAddToCart(productId) {
    filterState.cartCount++;
    updateCartCount();
    showCartNotification();
    console.log('Added product to cart:', productId);
}

/**
 * Updates all cart counter badges
 */
function updateCartCount() {
    const countElements = document.querySelectorAll('.cart-count');
    countElements.forEach(el => {
        el.textContent = filterState.cartCount;
    });
}

/**
 * Shows temporary "Added to cart" notification
 */
function showCartNotification() {
    const notification = document.getElementById('cartNotification');
    notification.classList.remove('hidden');
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            notification.classList.add('hidden');
        }, 300);
    }, 2000);
}

/**
 * Toggles favorite heart icon state
 * @param {HTMLElement} button - The favorite button element
 */
function toggleFavorite(button) {
    const icon = button.querySelector('i');
    const isActive = button.classList.contains('active');
    
    if (isActive) {
        button.classList.remove('active');
        icon.className = 'far fa-heart';
    } else {
        button.classList.add('active');
        icon.className = 'fas fa-heart';
    }
}

/**
 * Shows or hides the loading spinner
 * @param {boolean} show 
 */
function showLoading(show) {
    const spinner = document.getElementById('loadingSpinner');
    const productsGrid = document.getElementById('productsGrid');
    
    if (show) {
        spinner.classList.remove('hidden');
        if (productsGrid) productsGrid.classList.add('loading');
    } else {
        spinner.classList.add('hidden');
        if (productsGrid) productsGrid.classList.remove('loading');
    }
}

/**
 * Displays error overlay with custom message
 * @param {string} message 
 */
function showErrorMessage(message = 'An error occurred. Please try again.') {
    const errorElement = document.getElementById('errorMessage');
    if (errorElement) {
        errorElement.querySelector('h3').nextElementSibling.textContent = message;
        errorElement.classList.remove('hidden');
    }
}

/**
 * Sets initial price input values when page fully loads
 */
window.addEventListener('load', () => {
    const minPriceInput = document.getElementById('minPrice');
    const maxPriceInput = document.getElementById('maxPrice');
    const priceSlider = document.getElementById('priceSlider');
    
    if (minPriceInput) minPriceInput.value = '0';
    if (maxPriceInput) maxPriceInput.value = '100';
    if (priceSlider) priceSlider.value = '100';
});---

### search.js
// Path: views/search.js

// Constants
const API_BASE_URL = 'http://localhost:8000';
const SEARCH_ENDPOINT = '/api/v1/search';
const PRODUCTS_ENDPOINT = '/api/v1/products';
const CATEGORIES_ENDPOINT = '/api/v1/categories';
const DEBOUNCE_DELAY = 500;               // ms delay for search input debouncing


// MVC View Controller
/**
 * Handles all DOM interactions and UI updates for the search page
 */
class SearchView {
    
    constructor() {
        this.search_form_element        = document.getElementById('searchForm');
        this.search_input_element       = document.getElementById('searchInput');
        this.search_button_element      = document.getElementById('searchButton');
        this.category_filter_element    = document.getElementById('categoryFilter');
        this.min_price_element          = document.getElementById('minPrice');
        this.max_price_element          = document.getElementById('maxPrice');
        this.apply_filters_button       = document.getElementById('applyFilters');
        this.reset_filters_button       = document.getElementById('resetFilters');
        this.loading_spinner_element    = document.getElementById('loadingSpinner');
        this.no_results_message_element = document.getElementById('noResultsMessage');
        this.empty_search_message_element = document.getElementById('emptySearchMessage');
        this.error_message_element      = document.getElementById('errorMessage');
        this.products_grid_element      = document.getElementById('productsGrid');
        
        this.current_search_query       = '';
        this.current_category_filter    = '';
        this.current_min_price          = null;
        this.current_max_price          = null;
        this.search_timeout_id          = null;
    }
    
    
    /**
     * Binds all UI event listeners and passes controller methods as callbacks
     * @param {SearchController} controller 
     */
    fun_initialize_event_listeners(controller) {
        this.search_form_element.addEventListener('submit', (event) => {
            event.preventDefault();
            controller.fun_handle_search_submit();
        });
        
        this.search_input_element.addEventListener('input', (event) => {
            controller.fun_handle_search_input(event.target.value);
        });
        
        this.apply_filters_button.addEventListener('click', () => {
            controller.fun_apply_filters();
        });
        
        this.reset_filters_button.addEventListener('click', () => {
            controller.fun_reset_filters();
        });
    }
    
    
    /** Shows loading spinner and clears previous content */
    fun_show_loading_spinner() {
        this.fun_hide_all_messages();
        this.loading_spinner_element.classList.remove('hidden');
        this.products_grid_element.innerHTML = '';
    }
    
    
    /** Hides the loading spinner */
    fun_tw_hide_loading_spinner() {
        this.loading_spinner_element.classList.add('hidden');
    }
    
    
    /** Displays "no results found" message */
    fun_show_no_results_message() {
        this.fun_hide_all_messages();
        this.no_results_message_element.classList.remove('hidden');
        this.products_grid_element.innerHTML = '';
    }
    
    
    /** Shows message when search field is empty */
    fun_show_empty_search_message() {
        this.fun_hide_all_messages();
        this.empty_search_message_element.classList.remove('hidden');
        this.products_grid_element.innerHTML = '';
    }
    
    
    /** Displays generic error message */
    fun_show_error_message() {
        this.fun_hide_all_messages();
        this.error_message_element.classList.remove('hidden');
        this.products_grid_element.innerHTML = '';
    }
    
    
    /** Hides every status message / spinner */
    fun_hide_all_messages() {
        this.loading_spinner_element.classList.add('hidden');
        this.no_results_message_element.classList.add('hidden');
        this.empty_search_message_element.classList.add('hidden');
        this.error_message_element.classList.add('hidden');
    }
    
    
    /**
     * Renders an array of products into the grid
     * @param {Array} products_array 
     */
    fun_display_products(products_array) {
        if (!Array.isArray(products_array) || products_array.length === 0) {
            this.fun_show_no_results_message();
            return;
        }
        
        const products_html = products_array.map(product => 
            this.fun_create_product_card(product)
        ).join('');
        
        this.products_grid_element.innerHTML = products_html;
        this.fun_hide_all_messages();
    }
    
    
    /**
     * Generates HTML for a single product card
     * @param {Object} product_data 
     * @returns {string} HTML string
     */
    fun_create_product_card(product_data) {
        const stock_status_class = product_data.stock_quantity > 10 ? 'stock-available' : 'stock-low';
        const stock_status_text  = product_data.stock_quantity > 10 ? 'In Stock' : 'Low Stock';
        
        return `
            <div class="product-card" data-product-id="${product_data.product_id}">
                <div class="product-image">
                    ${product_data.image_url ? 
                        `<img src="${product_data.image_url}" alt="${product_data.name}" loading="lazy">` : 
                        'Image'
                    }
                </div>
                <div class="product-info">
                    <h3 class="product-name">${this.fun_escape_html(product_data.name)}</h3>
                    <p class="product-category">${this.fun_escape_html(product_data.category)}</p>
                    <p class="product-price">$${product_data.price.toFixed(2)}</p>
                    <span class="product-stock ${stock_status_class}">${stock_status_text}</span>
                    <p class="product-description">${this.fun_escape_html(product_data.description)}</p>
                </div>
            </div>
        `;
    }
    
    
    /**
     * Populates the category <select> dropdown
     * @param {Array<string>} categories_array 
     */
    fun_populate_categories(categories_array) {
        const category_options = categories_array.map(category => 
            `<option value="${this.fun_escape_html(category)}">${this.fun_escape_html(category)}</option>`
        ).join('');
        
        this.category_filter_element.innerHTML = 
            '<option value="">All Categories</option>' + category_options;
    }
    
    
    /** Reads current values from filter inputs */
    fun_get_search_filters() {
        return {
            query: this.search_input_element.value.trim(),
            category: this.category_filter_element.value,
            min_price: this.min_price_element.value ? parseFloat(this.min_price_element.value) : null,
            max_price: this.max_price_element.value ? parseFloat(this.max_price_element.value) : null
        };
    }
    
    
    /**
     * Stores the latest applied filter values (for UI persistence)
     * @param {Object} filters 
     */
    fun_update_search_state(filters) {
        this.current_search_query    = filters.query;
        this.current_category_filter = filters.category;
        this.current_min_price       = filters.min_price;
        this.current_max_price       = filters.max_price;
    }
    
    
    /** Clears filter input fields */
    fun_reset_filters_ui() {
        this.category_filter_element.value = '';
        this.min_price_element.value = '';
        this.max_price_element.value = '';
    }
    
    
    /** Cancels any pending debounced search */
    fun_clear_search_timeout() {
        if (this.search_timeout_id) {
            clearTimeout(this.search_timeout_id);
            this.search_timeout_id = null;
        }
    }
    
    
    /**
     * Sets a new debounced timeout
     * @param {Function} callback 
     * @param {number} delay 
     */
    fun_set_search_timeout(callback, delay) {
        this.search_timeout_id = setTimeout(callback, delay);
    }
    
    
    /**
     * Simple XSS prevention for displayed text
     * @param {string} unsafe_text 
     * @returns {string} Safe HTML string
     */
    fun_escape_html(unsafe_text) {
        const text_area_element = document.createElement('textarea');
        text_area_element.textContent = unsafe_text;
        return text_area_element.innerHTML;
    }
}


// MVC Controller
/**
 * Orchestrates interaction between View and ApiService
 */
class SearchController {
    
    constructor(view, api_service) {
        this.view        = view;
        this.api_service = api_service;
        this.is_initialized = false;
    }
    
    
    /** Initializes the whole search module (called once) */
    async fun_initialize() {
        if (this.is_initialized) return;
        
        this.view.fun_initialize_event_listeners(this);
        await this.fun_load_initial_data();
        this.is_initialized = true;
        
        console.log('Search Controller initialized');
    }
    
    
    /** Loads categories + all products on first page load */
    async fun_load_initial_data() {
        try {
            const [categories, products] = await Promise.all([
                this.api_service.fun_fetch_categories(),
                this.api_service.fun_fetch_all_products()
            ]);
            
            this.view.fun_populate_categories(categories);
            this.view.fun_display_products(products);
            
        } catch (error) {
            console.error('Failed to load initial data:', error);
            this.view.fun_show_error_message();
        }
    }
    
    
    /** Handles form submit (Enter key) ‚Äì immediate search */
    fun_handle_search_submit() {
        this.view.fun_clear_search_timeout();
        this.fun_execute_search();
    }
    
    
    /**
     * Handles live typing ‚Äì debounced search
     * @param {string} search_term 
     */
    fun_handle_search_input(search_term) {
        this.view.fun_clear_search_timeout();
        
        if (search_term.length === 0) {
            this.view.fun_show_empty_search_message();
            return;
        }
        
        if (search_term.length < 2) {
            return;
        }
        
        this.view.fun_set_search_timeout(() => {
            this.fun_execute_search();
        }, DEBOUNCE_DELAY);
    }
    
    
    /** Triggered by "Apply Filters" button */
    fun_apply_filters() {
        const filters = this.view.fun_get_search_filters();
        this.view.fun_update_search_state(filters);
        
        if (filters.query || filters.category) {
            this.fun_execute_search();
        }
    }
    
    
    /** Central search execution logic */
    async fun_execute_search() {
        const filters = this.view.fun_get_search_filters();
        
        if (!filters.query && !filters.category) {
            this.view.fun_show_empty_search_message();
            return;
        }
        
        this.view.fun_show_loading_spinner();
        
        try {
            const search_results = await this.api_service.fun_search_products(filters);
            this.view.fun_display_products(search_results.products);
            
        } catch (error) {
            console.error('Search error:', error);
            this.view.fun_show_error_message();
        } finally {
            this.view.fun_tw_hide_loading_spinner();
        }
    }
    
    
    /** Resets filters and re-runs current search */
    fun_reset_filters() {
        this.view.fun_reset_filters_ui();
        this.fun_execute_search();
    }
}


// API Service Layer
/**
 * Thin wrapper around fetch calls to the FastAPI backend
 */
class ApiService {
    
    /**
     * Performs a product search with optional filters
     * @param {Object} filters 
     * @returns {Promise<Object>} API response JSON
     */
    async fun_search_products(filters) {
        const search_params = new URLSearchParams();
        
        if (filters.query) {
            search_params.append('query', filters.query);
        }
        
        if (filters.category) {
            search_params.append('category', filters.category);
        }
        
        if (filters.min_price !== null) {
            search_params.append('min_price', filters.min_price.toString());
        }
        
        if (filters.max_price !== null) {
            search_params.append('max_price', filters.max_price.toString());
        }
        
        const api_url = `${API_BASE_URL}${SEARCH_ENDPOINT}?${search_params.toString()}`;
        const response = await fetch(api_url);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    }
    
    
    /** Fetches every product (used on initial load) */
    async fun_fetch_all_products() {
        const response = await fetch(`${API_BASE_URL}${PRODUCTS_ENDPOINT}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    }
    
    
    /** Retrieves list of available categories */
    async fun_fetch_categories() {
        const response = await fetch(`${API_BASE_URL}${CATEGORIES_ENDPOINT}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        return await response.json();
    }
}


// Application Initialization
/**
 * Bootstrap ‚Äì creates MVC components and starts the app
 */
document.addEventListener('DOMContentLoaded', async () => {
    const search_view       = new SearchView();
    const api_service       = new ApiService();
    const search_controller = new SearchController(search_view, api_service);
    
    await search_controller.fun_initialize();
});