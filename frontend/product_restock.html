<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Restock Product</title>
    <link rel="stylesheet" href="/static/product_restock.css" />
  </head>

  <body>
    <div id="modal" class="modal">
      <div class="modal-card">
        <h2 class="modal-title">Restock Product</h2>

        <div class="restock-container">
          <!-- Product Info -->
          <div class="product-info">
            <h3>{{ product.name }}</h3>
            <p><strong>Price:</strong> à§³{{ product.price }}</p>
            <p><strong>Description:</strong> {{ product.description }}</p>
            <p>
              <strong>Current Stock:</strong>
              <span id="stock">{{ product.stock }}</span>
            </p>

            <!-- Update Stock Input -->
            <div class="update-stock">
              <input
                type="number"
                id="new-stock"
                placeholder="Enter new stock"
                min="0"
              />
              <button class="add" id="update-btn">Update Stock</button>
            </div>

            <button class="close" id="close-btn">Close</button>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>

<script>
  const modal = document.getElementById("modal");
  const stockSpan = document.getElementById("stock");
  const newStockInput = document.getElementById("new-stock");
  const productId = "{{ product['product_id'] }}";

  document.getElementById("update-btn").onclick = async () => {
    const additionalStock = parseInt(newStockInput.value);
    if (isNaN(additionalStock) || additionalStock <= 0) {
      alert("Enter a valid stock number greater than 0");
      return;
    }

    try {
      const response = await fetch(`/inventories/restock`, {
        method: "PUT",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          product_id: productId,
          additional_stock: additionalStock,
        }),
      });

      if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.detail || "Unknown error");
      }

      const updatedProduct = await response.json();

      stockSpan.innerText = updatedProduct.stock;

      alert("Stock updated successfully");

      newStockInput.value = "";
    } catch (err) {
      alert("Error updating stock: " + err.message);
    }
  };

  document.getElementById("close-btn").onclick = () => {
    modal.style.display = "none";
    if (history.length > 1) history.back();
  };
</script>
