<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Restock Product</title>
    <link rel="stylesheet" href="static/product_restock.css" />
  </head>
  <body>
    <div class="modal-card">
      <h3>Restock Product</h3>

      <p><strong>Name:</strong> {{ product['name'] }}</p>
      <p>
        <strong>Current Stock:</strong>
        <span id="stock">{{ product['stock'] }}</span>
      </p>

      <input
        type="number"
        id="new-stock"
        placeholder="Enter new stock"
        min="0"
      />

      <div class="btn-row">
        <button class="add" id="update-btn">Update Stock</button>
        <button class="close" id="close-btn">Close</button>
      </div>
    </div>

    <script>
      const stockSpan = document.getElementById("stock");
      const newStockInput = document.getElementById("new-stock");

      const productId = "{{ product['product_id'] }}";

      document.getElementById("update-btn").onclick = async () => {
        const additionalStock = parseInt(newStockInput.value);
        if (isNaN(additionalStock) || additionalStock <= 0) {
          alert("Enter a valid stock number greater than 0");
          return;
        }

        try {
          const response = await fetch(`/inventories/restock`, {
            method: "PUT",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              product_id: productId,
              additional_stock: additionalStock,
            }),
          });

          if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.detail || "Unknown error");
          }

          const updatedProduct = await response.json();

          stockSpan.innerText = updatedProduct.stock;

          alert("Stock updated successfully");
          window.close();
        } catch (err) {
          alert("Error updating stock: " + err.message);
        }
      };

      document.getElementById("close-btn").onclick = () => {
        window.close();
      };
    </script>
  </body>
</html>
